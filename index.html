<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>PetCTT Pro - Î∞òÎ†§ÎèôÎ¨º ÏñëÎ∞©Ìñ• ÌÜµÏó≠ + ÏúÑÏπò Ï∂îÏ†Å</title>

    <!-- Ï∫êÏãú Î¨¥Ìö®Ìôî (Í∞ïÏ†ú ÏÉàÎ°úÍ≥†Ïπ®Ïö©) -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate, max-age=0">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <meta name="version" content="4f88d81-20260115-complete">

    <!-- PWA -->
    <link rel="manifest" href="manifest.webmanifest">
    <meta name="theme-color" content="#0a1628">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="description" content="AI Í∏∞Î∞ò Î∞òÎ†§ÎèôÎ¨º ÏñëÎ∞©Ìñ• Ïã§ÏãúÍ∞Ñ ÏùåÏÑ± ÌÜµÏó≠ + GPS ÏúÑÏπò Ï∂îÏ†Å ÏãúÏä§ÌÖú">

    <!-- Leaflet ÏßÄÎèÑ ÎùºÏù¥Î∏åÎü¨Î¶¨ -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.js"></script>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;600;700;900&display=swap"
        rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>

    <style>
        :root {
            /* PetCTT Original Palette (Restored) */
            --primary: #10b981;
            --primary-dark: #059669;
            --primary-light: #34d399;
            --secondary: #6366f1;
            --accent: #f59e0b;
            --danger: #ef4444;
            --bg-dark: #0a1628;
            --bg-card: rgba(0, 0, 0, 0.15);
            /* Keep Glass Effect */
            --bg-card-light: rgba(26, 41, 66, 0.6);
            /* Semi-transparent Slate */
            --text: #f1f5f9;
            --text-muted: #94a3b8;
            --border: rgba(16, 185, 129, 0.3);
            --glow-primary: 0 0 20px rgba(16, 185, 129, 0.4);
            --glow-secondary: 0 0 20px rgba(99, 102, 241, 0.4);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans KR', -apple-system, BlinkMacSystemFont, sans-serif;
            background: transparent;
            /* Allow canvas container to show */
            color: var(--text);
            min-height: 100vh;
            line-height: 1.6;
            overflow-x: hidden;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
        }

        #canvas-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            background: linear-gradient(135deg, var(--bg-dark) 0%, #0f172a 50%, #1e1b4b 100%);
            /* PetCTT Background */
            pointer-events: none;
        }

        #liveVideo {
            position: relative;
            z-index: 9999;
            background: #000;
            min-height: 250px;
            width: 100%;
            display: block;
            object-fit: cover;
            visibility: visible !important;
            opacity: 1 !important;
        }

        #bioVideo {
            position: relative;
            z-index: 9999;
            background: #000;
            min-height: 240px;
            width: 100%;
            object-fit: cover;
            visibility: visible !important;
            opacity: 1 !important;
        }

        .container {
            position: relative;
            z-index: 10;
            /* Ensure content is above canvas */
            max-width: 480px;
            margin: 0 auto;
            padding: 0 16px;
        }

        /* ===== Ìó§Îçî ===== */
        header {
            position: sticky;
            top: 0;
            z-index: 100;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--border);
            padding: 12px 0;
        }

        .header-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 900;
            font-size: 1.4rem;
        }

        .logo-icon {
            font-size: 2rem;
            animation: bounce 2s ease-in-out infinite;
        }

        @keyframes bounce {

            0%,
            100% {
                transform: translateY(0);
            }

            50% {
                transform: translateY(-5px);
            }
        }

        .logo-text {
            background: linear-gradient(135deg, var(--secondary) 0%, var(--primary) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 0 0 20px rgba(168, 85, 247, 0.5);
            font-family: 'Orbitron', sans-serif;
            letter-spacing: 1px;
        }

        /* ÏÉÅÌÉú Î±ÉÏßÄ */
        .status-badge {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            transition: all 0.3s;
        }

        .status-badge.ready {
            background: rgba(100, 116, 139, 0.2);
            border: 1px solid rgba(100, 116, 139, 0.4);
            color: #94a3b8;
        }

        .status-badge.live {
            background: rgba(16, 185, 129, 0.2);
            border: 1px solid rgba(16, 185, 129, 0.5);
            color: var(--primary-light);
            animation: pulse-badge 1.5s ease-in-out infinite;
        }

        .status-badge.recording {
            background: rgba(239, 68, 68, 0.2);
            border: 1px solid rgba(239, 68, 68, 0.5);
            color: #f87171;
            animation: pulse-badge 0.8s ease-in-out infinite;
        }

        @keyframes pulse-badge {

            0%,
            100% {
                box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.4);
            }

            50% {
                box-shadow: 0 0 0 8px rgba(16, 185, 129, 0);
            }
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: currentColor;
        }

        /* ===== ÌÉ≠ ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò ===== */
        .tab-nav {
            display: flex;
            gap: 8px;
            justify-content: center;
            margin-bottom: 16px;
            padding: 0 16px;
        }

        .tab-btn {
            flex: 1;
            padding: 12px 16px;
            border-radius: 12px;
            border: 1px solid rgba(100, 116, 139, 0.3);
            background: var(--bg-card-light);
            color: var(--text-muted);
            cursor: pointer;
            font-size: 0.85rem;
            font-weight: 600;
            transition: all 0.3s;
            backdrop-filter: blur(4px);
        }

        .tab-btn.active {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            border-color: var(--primary);
        }

        .tab-btn:hover {
            border-color: var(--primary);
        }

        /* ===== Î©îÏù∏ Ïπ¥Îìú ===== */
        .main-card {
            background: rgba(0, 0, 0, 0.15);
            /* Very Transparent */
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-top: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 24px;
            padding: 24px;
            margin: 20px 0;
            position: relative;
            overflow: visible;
            /* Fix for mobile video clipping */
            /* backdrop-filter removed */
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
        }

        .main-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, transparent, var(--primary), var(--primary-light), transparent);
        }

        /* Neon Effects from AIRCTT */
        .neon-text {
            text-shadow: 0 0 10px rgba(168, 85, 247, 0.8), 0 0 20px rgba(168, 85, 247, 0.6);
        }

        /* ÏÑπÏÖò */
        .section {
            display: none;
        }

        .section.active {
            display: block;
        }

        /* ÏÑπÏÖò Ï†úÎ™© */
        .section-title {
            font-size: 0.85rem;
            color: var(--text-muted);
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* ===== ÎèôÎ¨º ÏÑ†ÌÉù ===== */
        .animal-selector {
            display: flex;
            gap: 12px;
            justify-content: center;
            margin-bottom: 24px;
        }

        .animal-btn {
            width: 80px;
            height: 90px;
            border-radius: 16px;
            background: var(--bg-card-light);
            border: 2px solid transparent;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 6px;
        }

        .animal-btn:hover {
            transform: translateY(-4px);
            border-color: rgba(16, 185, 129, 0.4);
        }

        .animal-btn.selected {
            border-color: var(--primary);
            background: rgba(34, 211, 238, 0.15);
            box-shadow: 0 0 20px rgba(34, 211, 238, 0.4), inset 0 0 10px rgba(34, 211, 238, 0.2);
        }

        .animal-btn .icon {
            font-size: 2.2rem;
        }

        .animal-btn .name {
            font-size: 0.75rem;
            color: var(--text-muted);
        }

        .animal-btn.selected .name {
            color: var(--primary-light);
            font-weight: 700;
            text-shadow: 0 0 10px var(--primary);
        }

        /* ÏÑ§Ï†ï Î≤ÑÌäº */
        .settings-btn {
            width: 80px;
            height: 90px;
            border-radius: 16px;
            background: var(--bg-card-light);
            border: 1px solid rgba(100, 116, 139, 0.3);
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 6px;
            color: var(--text-muted);
        }

        .settings-btn:hover {
            background: rgba(100, 116, 139, 0.2);
            transform: rotate(90deg);
        }

        .settings-btn .icon {
            font-size: 1.8rem;
        }

        .settings-btn .name {
            font-size: 0.7rem;
        }

        /* ===== Î©îÏù∏ Ïª®Ìä∏Î°§ Î≤ÑÌäº ===== */
        .control-buttons {
            display: flex;
            gap: 12px;
            justify-content: center;
            margin-bottom: 24px;
        }

        .btn-start {
            flex: 1;
            max-width: 200px;
            padding: 16px 24px;
            border-radius: 16px;
            border: none;
            font-size: 1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-start.start {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            box-shadow: 0 4px 20px rgba(16, 185, 129, 0.4);
        }

        .btn-start.start:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 8px 30px rgba(16, 185, 129, 0.5);
        }

        .btn-start.start:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .btn-start.stop {
            background: rgba(239, 68, 68, 0.2);
            border: 2px solid var(--danger);
            color: #f87171;
        }

        .btn-start.stop:hover:not(:disabled) {
            background: rgba(239, 68, 68, 0.3);
        }

        .btn-start.stop:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        /* ===== ÌÜµÏó≠ Ìå®ÎÑê ===== */
        .translate-panel {
            background: rgba(0, 0, 0, 0.1);
            /* Crystal Clear */
            border: 1px solid rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 20px;
            /* backdrop-filter removed to fix mobile video rendering */
        }

        /* Î∞©Ìñ• ÌëúÏãú */
        .direction-display {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 16px;
            margin-bottom: 20px;
            padding-bottom: 16px;
            border-bottom: 1px solid rgba(100, 116, 139, 0.2);
        }

        .direction-item {
            text-align: center;
        }

        .direction-item .icon {
            font-size: 2.5rem;
            display: block;
            margin-bottom: 4px;
        }

        .direction-item .label {
            font-size: 0.75rem;
            color: var(--text-muted);
        }

        .direction-arrow {
            font-size: 1.5rem;
            color: var(--primary);
            animation: arrow-pulse 1.5s ease-in-out infinite;
        }

        @keyframes arrow-pulse {

            0%,
            100% {
                opacity: 0.5;
                transform: scale(1);
            }

            50% {
                opacity: 1;
                transform: scale(1.1);
            }
        }

        /* ÎßàÏù¥ÌÅ¨ Î≤ÑÌäº ÏòÅÏó≠ */
        .mic-buttons {
            display: flex;
            justify-content: center;
            gap: 40px;
            margin-bottom: 20px;
        }

        .mic-group {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }

        .mic-btn {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            border: none;
            cursor: pointer;
            font-size: 2rem;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
            position: relative;
        }

        .mic-btn.human {
            background: linear-gradient(135deg, var(--danger) 0%, #dc2626 100%);
            box-shadow: 0 4px 20px rgba(239, 68, 68, 0.4);
        }

        .mic-btn.animal {
            background: linear-gradient(135deg, var(--accent) 0%, #d97706 100%);
            box-shadow: 0 4px 20px rgba(245, 158, 11, 0.4);
        }

        .mic-btn:hover:not(:disabled) {
            transform: scale(1.1);
        }

        .mic-btn:disabled {
            opacity: 0.4;
            cursor: not-allowed;
            transform: none;
        }

        .mic-btn.recording {
            animation: mic-pulse 0.6s ease-in-out infinite;
        }

        @keyframes mic-pulse {

            0%,
            100% {
                transform: scale(1);
                box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.5);
            }

            50% {
                transform: scale(1.05);
                box-shadow: 0 0 0 15px rgba(239, 68, 68, 0);
            }
        }

        .mic-label {
            font-size: 0.8rem;
            color: var(--text-muted);
            text-align: center;
            line-height: 1.3;
        }

        /* ÌååÌòï + ÌÉÄÏù¥Î®∏ */
        .waveform-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            min-height: 60px;
        }

        .waveform {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 4px;
            height: 40px;
        }

        .waveform-bar {
            width: 5px;
            background: linear-gradient(180deg, var(--primary) 0%, var(--primary-light) 100%);
            border-radius: 3px;
            transition: height 0.1s;
        }

        .waveform.active .waveform-bar {
            animation: wave 0.4s ease-in-out infinite;
        }

        .waveform.inactive .waveform-bar {
            height: 6px !important;
            opacity: 0.3;
            animation: none;
        }

        .waveform-bar:nth-child(1) {
            animation-delay: 0s;
        }

        .waveform-bar:nth-child(2) {
            animation-delay: 0.1s;
        }

        .waveform-bar:nth-child(3) {
            animation-delay: 0.2s;
        }

        .waveform-bar:nth-child(4) {
            animation-delay: 0.15s;
        }

        .waveform-bar:nth-child(5) {
            animation-delay: 0.25s;
        }

        .waveform-bar:nth-child(6) {
            animation-delay: 0.1s;
        }

        .waveform-bar:nth-child(7) {
            animation-delay: 0.05s;
        }

        @keyframes wave {

            0%,
            100% {
                height: 10px;
            }

            50% {
                height: 35px;
            }
        }

        .timer {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--danger);
            font-variant-numeric: tabular-nums;
        }

        .timer.hidden {
            display: none;
        }

        /* ÏÉÅÌÉú ÌÖçÏä§Ìä∏ */
        .status-text {
            text-align: center;
            font-size: 0.85rem;
            color: var(--text-muted);
            padding: 8px 16px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 20px;
            margin-top: 12px;
        }

        /* ===== Ï±ÑÌåÖ/Í≤∞Í≥º ÏòÅÏó≠ ===== */
        .chat-container {
            max-height: 300px;
            overflow-y: auto;
            padding: 12px;
            background: rgba(0, 0, 0, 0.1);
            /* Crystal Clear */
            border: 1px solid rgba(255, 255, 255, 0.05);
            border-radius: 16px;
            margin-bottom: 16px;
            backdrop-filter: blur(5px);
        }

        .bubble {
            max-width: 90%;
            padding: 12px 16px;
            border-radius: 16px;
            margin-bottom: 12px;
            animation: bubble-in 0.3s ease-out;
            position: relative;
        }

        @keyframes bubble-in {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .bubble.system {
            background: linear-gradient(135deg, rgba(16, 46, 30, 0.8), rgba(10, 26, 20, 0.8));
            border: 1px solid rgba(16, 185, 129, 0.3);
            margin-left: auto;
            margin-right: auto;
            max-width: 95%;
            text-align: center;
            font-size: 0.85rem;
        }

        .bubble.human {
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.3), rgba(79, 70, 229, 0.2));
            border: 1px solid rgba(99, 102, 241, 0.4);
            margin-left: auto;
            text-align: right;
        }

        .bubble.animal {
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.2), rgba(217, 119, 6, 0.15));
            border: 1px solid rgba(245, 158, 11, 0.4);
            margin-right: auto;
        }

        .bubble.translation {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.2), rgba(5, 150, 105, 0.15));
            border: 1px solid rgba(16, 185, 129, 0.4);
            margin-right: auto;
        }

        .bubble-header {
            font-size: 0.7rem;
            color: var(--text-muted);
            margin-bottom: 4px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .bubble-content {
            font-size: 0.95rem;
            line-height: 1.5;
        }

        /* Ïû¨ÏÉù Î≤ÑÌäº */
        .play-btn {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 6px 12px;
            margin-top: 8px;
            background: rgba(16, 185, 129, 0.2);
            border: 1px solid var(--primary);
            border-radius: 20px;
            color: var(--primary-light);
            font-size: 0.75rem;
            cursor: pointer;
            transition: all 0.3s;
        }

        .play-btn:hover {
            background: rgba(16, 185, 129, 0.3);
        }

        /* ===== ÌïôÏäµ ÏßÑÌñâÎ•† ===== */
        .learning-section {
            background: rgba(0, 0, 0, 0.1);
            /* Crystal Clear */
            border: 1px solid rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 16px;
            backdrop-filter: blur(5px);
        }

        .learning-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .learning-title {
            font-size: 0.85rem;
            color: var(--text-muted);
        }

        .learning-percent {
            font-size: 0.9rem;
            font-weight: 700;
            color: var(--primary-light);
        }

        .progress-bar {
            height: 8px;
            background: rgba(100, 116, 139, 0.3);
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary) 0%, var(--primary-light) 100%);
            border-radius: 4px;
            transition: width 0.5s ease-out;
        }

        .learning-hint {
            font-size: 0.7rem;
            color: var(--text-muted);
            margin-top: 8px;
            opacity: 0.7;
        }

        /* ===== ÏúÑÏπò Ï∂îÏ†Å ÏÑπÏÖò ===== */
        #mapContainer {
            width: 100%;
            height: 400px;
            border-radius: 16px;
            margin-bottom: 16px;
            overflow: hidden;
            border: 1px solid var(--border);
        }

        .location-info {
            background: rgba(0, 0, 0, 0.1);
            /* Crystal Clear */
            border: 1px solid rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 16px;
            backdrop-filter: blur(5px);
        }

        .location-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid rgba(100, 116, 139, 0.2);
            font-size: 0.85rem;
        }

        .location-item:last-child {
            border-bottom: none;
        }

        .location-label {
            color: var(--text-muted);
        }

        .location-value {
            font-weight: 600;
            color: var(--primary-light);
            font-family: 'Courier New', monospace;
        }

        .btn-track {
            width: 100%;
            padding: 14px;
            margin-bottom: 12px;
            border-radius: 12px;
            border: none;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-track:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(16, 185, 129, 0.4);
        }

        .btn-track:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-track.stop {
            background: rgba(239, 68, 68, 0.2);
            border: 2px solid var(--danger);
            color: #f87171;
        }

        /* ÏúÑÏπò ÌûàÏä§ÌÜ†Î¶¨ */
        .location-history {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 12px;
            padding: 16px;
            max-height: 200px;
            overflow-y: auto;
        }

        .history-item {
            padding: 8px;
            background: rgba(16, 185, 129, 0.1);
            border: 1px solid rgba(16, 185, 129, 0.2);
            border-radius: 8px;
            margin-bottom: 8px;
            font-size: 0.75rem;
        }

        .history-time {
            color: var(--text-muted);
        }

        .history-coords {
            color: var(--primary-light);
            font-weight: 600;
            font-family: monospace;
        }

        /* ===== ÌÜ†Ïä§Ìä∏ ===== */
        .toast {
            position: fixed;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%) translateY(20px);
            padding: 14px 24px;
            border-radius: 12px;
            font-size: 0.9rem;
            font-weight: 500;
            z-index: 1000;
            opacity: 0;
            transition: all 0.3s;
            max-width: 90%;
            text-align: center;
        }

        .toast.show {
            opacity: 1;
            transform: translateX(-50%) translateY(0);
        }

        .toast.success {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.95), rgba(5, 150, 105, 0.95));
            box-shadow: 0 4px 20px rgba(16, 185, 129, 0.4);
        }

        .toast.error {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.95), rgba(220, 38, 38, 0.95));
            box-shadow: 0 4px 20px rgba(239, 68, 68, 0.4);
        }

        .toast.info {
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.95), rgba(79, 70, 229, 0.95));
            box-shadow: 0 4px 20px rgba(99, 102, 241, 0.4);
        }

        /* ===== ÏÑ§Ï†ï Î™®Îã¨ ===== */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.85);
            z-index: 200;
            display: none;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal-overlay.show {
            display: flex;
        }

        .modal {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 24px;
            max-width: 400px;
            width: 100%;
            padding: 24px;
            position: relative;
        }

        .modal-close {
            position: absolute;
            top: 16px;
            right: 16px;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: rgba(100, 116, 139, 0.2);
            border: none;
            color: var(--text-muted);
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.3s;
        }

        .modal-close:hover {
            background: rgba(239, 68, 68, 0.3);
            color: #f87171;
        }

        .modal-title {
            font-size: 1.2rem;
            font-weight: 700;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .setting-item {
            margin-bottom: 20px;
        }

        .setting-label {
            font-size: 0.85rem;
            color: var(--text-muted);
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .setting-value {
            font-size: 0.8rem;
            color: var(--primary-light);
            margin-left: auto;
        }

        input[type="range"] {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: rgba(100, 116, 139, 0.3);
            outline: none;
            -webkit-appearance: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: var(--primary);
            cursor: pointer;
            box-shadow: 0 2px 10px rgba(16, 185, 129, 0.4);
        }

        .modal-save {
            width: 100%;
            padding: 14px;
            border-radius: 12px;
            border: none;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 10px;
        }

        .modal-save:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(16, 185, 129, 0.4);
        }

        /* ===== Ìë∏ÌÑ∞ ===== */
        footer {
            text-align: center;
            padding: 20px;
            color: var(--text-muted);
            font-size: 0.75rem;
        }

        footer a {
            color: var(--primary);
            text-decoration: none;
        }

        /* ===== Í±¥Í∞ïÏ≤¥ÌÅ¨ ÏÑπÏÖò ===== */
        .meter-bar {
            height: 24px;
            background: rgba(100, 116, 139, 0.3);
            border-radius: 12px;
            overflow: hidden;
            margin-bottom: 16px;
        }

        .meter-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary) 0%, var(--accent) 100%);
            border-radius: 12px;
            transition: width 0.2s ease-out;
            width: 0%;
        }

        .health-stats {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 12px;
            margin-bottom: 16px;
        }

        .stat-item {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 12px;
            padding: 12px;
            text-align: center;
        }

        .stat-label {
            font-size: 0.7rem;
            color: var(--text-muted);
            margin-bottom: 6px;
        }

        .stat-value {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--primary-light);
        }

        /* ===== ÌÉ≠ ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò ===== */
        .tab-nav {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
            justify-content: center;
        }

        .tab-btn {
            padding: 10px 18px;
            border-radius: 12px;
            border: 1px solid rgba(100, 116, 139, 0.3);
            background: rgba(0, 0, 0, 0.2);
            color: var(--text-muted);
            font-size: 0.85rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .tab-btn:hover {
            border-color: rgba(16, 185, 129, 0.5);
            background: rgba(16, 185, 129, 0.1);
        }

        .tab-btn.active {
            border-color: var(--primary);
            background: rgba(16, 185, 129, 0.2);
            color: var(--primary-light);
        }

        .section {
            display: none;
        }

        .section.active {
            display: block;
            animation: fadeIn 0.3s ease-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        /* ===== Î∞òÏùëÌòï ===== */
        @media (max-width: 400px) {
            .animal-selector {
                gap: 8px;
            }

            .animal-btn,
            .settings-btn {
                width: 65px;
                height: 75px;
            }

            .animal-btn .icon {
                font-size: 1.8rem;
            }

            .mic-btn {
                width: 70px;
                height: 70px;
                font-size: 1.7rem;
            }

            .mic-buttons {
                gap: 30px;
            }
        }
    </style>
</head>

<body>
    <!-- Ìó§Îçî -->
    <header>
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <span class="logo-icon">üêæ</span>
                    <span class="logo-text">PetCTT</span>
                </div>
                <div class="status-badge ready" id="statusBadge">
                    <span class="status-dot"></span>
                    <span id="statusText">LIVE Ï§ÄÎπÑ</span>
                </div>
            </div>
        </div>
    </header>

    <!-- Î©îÏù∏ -->
    <main class="container">
        <!-- ÌÉ≠ ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò -->
        <div class="tab-nav">
            <button class="tab-btn active" data-tab="live" onclick="switchTab('live')">üéôÔ∏è LIVE</button>
            <button class="tab-btn" data-tab="health" onclick="switchTab('health')">‚ù§Ô∏è Í±¥Í∞ï</button>
            <button class="tab-btn" data-tab="locate" onclick="switchTab('locate')">üó∫Ô∏è Ï∞æÍ∏∞</button>
            <button class="tab-btn"
                style="background: rgba(45, 212, 191, 0.2); border: 1px solid rgba(45, 212, 191, 0.4); color: var(--primary-light);"
                onclick="openBroadcastStation()">üì° ÏÑ§Ï†ï</button>
        </div>

        <!-- LIVE ÏÑπÏÖò -->
        <section id="live" class="section active">
            <div class="main-card">
                <!-- ÎèôÎ¨º ÏÑ†ÌÉù -->
                <div class="section-title">üêæ ÌÜµÏó≠Ìï† ÎèôÎ¨ºÏùÑ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî</div>
                <div class="animal-selector">
                    <button class="animal-btn selected" data-animal="dog" onclick="selectAnimal(this)">
                        <span class="icon">üê∂</span>
                        <span class="name">Í∞ïÏïÑÏßÄ</span>
                    </button>
                    <button class="animal-btn" data-animal="cat" onclick="selectAnimal(this)">
                        <span class="icon">üê±</span>
                        <span class="name">Í≥†ÏñëÏù¥</span>
                    </button>
                    <button class="animal-btn" data-animal="chick" onclick="selectAnimal(this)">
                        <span class="icon">üê•</span>
                        <span class="name">Î≥ëÏïÑÎ¶¨</span>
                    </button>
                    <button class="settings-btn" onclick="openSettings()">
                        <span class="icon">‚öôÔ∏è</span>
                        <span class="name">ÏÑ§Ï†ï</span>
                    </button>
                </div>

                <!-- Ïª®Ìä∏Î°§ Î≤ÑÌäº -->
                <div class="control-buttons">
                    <button class="btn-start start" id="btnStart" onclick="handleStart()">
                        <span>üêæ</span> ÎèôÎ¨ºÎåÄÌôî ÏãúÏûë
                    </button>
                    <button class="btn-start stop" id="btnStop" onclick="handleStop()" disabled>
                        <span>‚èπ</span> Ï§ëÏßÄ
                    </button>
                </div>

                <!-- ÌÜµÏó≠ Ìå®ÎÑê -->
                <div class="translate-panel">
                    <div class="direction-display">
                        <div class="direction-item">
                            <span class="icon">üë§</span>
                            <span class="label">Î≥¥Ìò∏Ïûê</span>
                        </div>
                        <span class="direction-arrow">‚áÑ</span>
                        <div class="direction-item">
                            <span class="icon" id="animalIcon">üê∂</span>
                            <span class="label" id="animalLabel">Í∞ïÏïÑÏßÄ</span>
                        </div>
                    </div>

                    <!-- üìπ Ïπ¥Î©îÎùº ÎπÑÎîîÏò§ (AIÎàà) -->
                    <div style="margin-bottom: 16px; position: relative;">
                        <!-- Ïπ¥Î©îÎùº Ï†ÑÎ©¥/ÌõÑÎ©¥ Ï†ÑÌôò Î≤ÑÌäº -->
                        <div id="cameraToggleButtons"
                            style="display: none; position: absolute; top: 12px; right: 12px; display: flex; gap: 8px; z-index: 100;">
                            <button onclick="switchCameraMode('user')" id="btnCameraFront"
                                style="padding: 8px 12px; background: rgba(45, 212, 191, 0.3); border: 1px solid rgba(45, 212, 191, 0.4); border-radius: 8px; color: var(--primary-light); font-size: 0.75rem; cursor: pointer; font-weight: 600; transition: all 0.3s;">
                                ü§≥ Ï†ÑÎ©¥
                            </button>
                            <button onclick="switchCameraMode('environment')" id="btnCameraBack"
                                style="padding: 8px 12px; background: rgba(45, 212, 191, 0.8); border: 1px solid rgba(45, 212, 191, 0.6); border-radius: 8px; color: white; font-size: 0.75rem; cursor: pointer; font-weight: 600; transition: all 0.3s;">
                                üì∑ ÌõÑÎ©¥
                            </button>
                        </div>
                        <video id="liveVideo"
                            style="display: block; width: 100%; min-height: 250px; border-radius: 12px; background: #000; margin-bottom: 12px; object-fit: cover; position: relative; z-index: 9999;"
                            autoplay playsinline webkit-playsinline muted></video>
                    </div>

                    <!-- Í∞êÏ†ïÎ∂ÑÏÑù Í∑∏ÎûòÌîÑ -->
                    <div id="emotionBars" style="display: none; margin-bottom: 16px; gap: 10px;">
                        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr 1fr 1fr; gap: 8px;">
                            <div style="text-align: center;">
                                <div style="font-size: 0.7rem; color: var(--text-muted); margin-bottom: 4px;">Î∂àÏïà</div>
                                <div class="emotion-bar"
                                    style="background: #ff6b6b; height: 60px; border-radius: 4px; position: relative;">
                                    <div style="position: absolute; bottom: 0; width: 100%; height: 0%; background: rgba(255, 107, 107, 0.8); border-radius: 4px; transition: height 0.3s;"
                                        id="emotionBar1"></div>
                                </div>
                            </div>
                            <div style="text-align: center;">
                                <div style="font-size: 0.7rem; color: var(--text-muted); margin-bottom: 4px;">Í≥†ÌÜµ</div>
                                <div class="emotion-bar"
                                    style="background: #ff8787; height: 60px; border-radius: 4px; position: relative;">
                                    <div style="position: absolute; bottom: 0; width: 100%; height: 0%; background: rgba(255, 135, 135, 0.8); border-radius: 4px; transition: height 0.3s;"
                                        id="emotionBar2"></div>
                                </div>
                            </div>
                            <div style="text-align: center;">
                                <div style="font-size: 0.7rem; color: var(--text-muted); margin-bottom: 4px;">Ìù•Î∂Ñ</div>
                                <div class="emotion-bar"
                                    style="background: #ffd700; height: 60px; border-radius: 4px; position: relative;">
                                    <div style="position: absolute; bottom: 0; width: 100%; height: 0%; background: rgba(255, 215, 0, 0.8); border-radius: 4px; transition: height 0.3s;"
                                        id="emotionBar3"></div>
                                </div>
                            </div>
                            <div style="text-align: center;">
                                <div style="font-size: 0.7rem; color: var(--text-muted); margin-bottom: 4px;">ÏïàÏ†ï</div>
                                <div class="emotion-bar"
                                    style="background: #2dd4bf; height: 60px; border-radius: 4px; position: relative;">
                                    <div style="position: absolute; bottom: 0; width: 100%; height: 0%; background: rgba(45, 212, 191, 0.8); border-radius: 4px; transition: height 0.3s;"
                                        id="emotionBar4"></div>
                                </div>
                            </div>
                            <div style="text-align: center;">
                                <div style="font-size: 0.7rem; color: var(--text-muted); margin-bottom: 4px;">ÏöîÍµ¨</div>
                                <div class="emotion-bar"
                                    style="background: #a05aff; height: 60px; border-radius: 4px; position: relative;">
                                    <div style="position: absolute; bottom: 0; width: 100%; height: 0%; background: rgba(160, 90, 255, 0.8); border-radius: 4px; transition: height 0.3s;"
                                        id="emotionBar5"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- ÎßàÏù¥ÌÅ¨ Î≤ÑÌäº -->
                    <div class="mic-buttons">
                        <div class="mic-group">
                            <button class="mic-btn human" id="btnHumanMic" onclick="handleHumanToAnimal()" disabled
                                title="ÎÇ¥Í∞Ä ÎßêÌïòÎ©¥ ÎèôÎ¨ºÏñ¥Î°ú ÌÜµÏó≠">
                                üé§
                            </button>
                            <span class="mic-label">ÎÇ¥Í∞Ä ÎßêÌïòÍ∏∞<br><small>(‚Üí ÎèôÎ¨ºÏñ¥)</small></span>
                        </div>
                        <div class="mic-group">
                            <button class="mic-btn animal" id="btnAnimalMic" onclick="handleAnimalToHuman()" disabled
                                title="ÎèôÎ¨º ÏÜåÎ¶¨Î•º ÏÇ¨ÎûåÎßêÎ°ú ÌÜµÏó≠">
                                üêæ
                            </button>
                            <span class="mic-label">ÎèôÎ¨º Îì£Í∏∞<br><small>(‚Üí ÏÇ¨ÎûåÎßê)</small></span>
                        </div>
                    </div>

                    <!-- ÌååÌòï + ÌÉÄÏù¥Î®∏ -->
                    <div class="waveform-container">
                        <div class="waveform inactive" id="waveform">
                            <div class="waveform-bar" style="height:15px"></div>
                            <div class="waveform-bar" style="height:25px"></div>
                            <div class="waveform-bar" style="height:20px"></div>
                            <div class="waveform-bar" style="height:30px"></div>
                            <div class="waveform-bar" style="height:22px"></div>
                            <div class="waveform-bar" style="height:28px"></div>
                            <div class="waveform-bar" style="height:18px"></div>
                        </div>
                        <div class="timer hidden" id="timer">3.0</div>
                    </div>

                    <div class="status-text" id="panelStatus">
                        ÎßàÏù¥ÌÅ¨ Î≤ÑÌäºÏùÑ ÎàåÎü¨ ÌÜµÏó≠ÏùÑ ÏãúÏûëÌïòÏÑ∏Ïöî
                    </div>
                </div>

                <!-- Ï±ÑÌåÖ/Í≤∞Í≥º -->
                <div class="chat-container" id="chatContainer">
                    <div class="bubble system">
                        <div class="bubble-content">üêæ "ÎèôÎ¨ºÎåÄÌôî ÏãúÏûë"ÏùÑ ÎàÑÎ•¥Í≥† ÎßàÏù¥ÌÅ¨Î°ú ÏñëÎ∞©Ìñ• ÌÜµÏó≠ÌïòÏÑ∏Ïöî!</div>
                    </div>
                </div>

                <!-- ÌïôÏäµ ÏßÑÌñâÎ•† -->
                <div class="learning-section">
                    <div class="learning-header">
                        <span class="learning-title">üß† AI ÌïôÏäµ ÏßÑÌñâÎ•†</span>
                        <span class="learning-percent" id="learningPercent">12.5%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="learningProgress" style="width: 12.5%"></div>
                    </div>
                    <div class="learning-hint">ÎåÄÌôîÌï†ÏàòÎ°ù ÌÜµÏó≠ Ï†ïÌôïÎèÑÍ∞Ä Ìñ•ÏÉÅÎê©ÎãàÎã§</div>
                </div>
            </div>
        </section>

        <!-- Í±¥Í∞ïÏ≤¥ÌÅ¨ ÏÑπÏÖò -->
        <section id="health" class="section">
            <div class="main-card">
                <div class="section-title">‚ù§Ô∏è AIÎäî Í∏∞Î∞ò ÏÉùÏ≤¥ Î∂ÑÏÑù</div>

                <!-- Í±¥Í∞ïÏ≤¥ÌÅ¨ Î™®Îìú ÏÑ†ÌÉù -->
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 16px;">
                    <button class="btn-start start" id="btnPulseMode" onclick="startPulseCheck()"
                        style="padding: 14px; background: rgba(45, 212, 191, 0.2); border: 2px solid rgba(45, 212, 191, 0.4); color: var(--primary-light); border-radius: 10px; cursor: pointer; font-weight: 600; font-size: 0.85rem;">
                        ü©π ÌéÑÏä§ÏÑºÏÑú (30Ï¥à)
                    </button>
                    <button class="btn-start start" id="btnBioMode" onclick="startBioScan()"
                        style="padding: 14px; background: rgba(45, 212, 191, 0.8); border: 2px solid rgba(45, 212, 191, 0.6); color: white; border-radius: 10px; cursor: pointer; font-weight: 600; font-size: 0.85rem;">
                        üîç ÏÉùÏ≤¥Ïä§Ï∫î (AI)
                    </button>
                </div>

                <!-- AI Í∏∞Î∞ò ÏÉùÏ≤¥Î∂ÑÏÑù Î™®Îìú -->
                <div id="bioScanMode" style="display: none;">
                    <div
                        style="background: rgba(45, 212, 191, 0.15); border: 1px solid rgba(45, 212, 191, 0.4); border-radius: 12px; padding: 16px; margin-bottom: 16px;">
                        <div style="font-size: 0.85rem; color: var(--text-muted); margin-bottom: 8px;">üì∏ Ïπ¥Î©îÎùºÎ•º ÌÜµÌïú Ïã§ÏãúÍ∞Ñ
                            ÏÉùÏ≤¥Î∂ÑÏÑù</div>

                        <!-- Ïπ¥Î©îÎùº Ï†Ñ/ÌõÑ Ï†ÑÌôò Î≤ÑÌäº -->
                        <div style="display: flex; gap: 8px; margin-bottom: 12px;">
                            <button onclick="switchBioCamera('user')" id="bioCameraFront"
                                style="flex: 1; padding: 8px; background: rgba(45, 212, 191, 0.8); border: 1px solid rgba(45, 212, 191, 0.6); border-radius: 8px; color: white; cursor: pointer; font-weight: 600; font-size: 0.8rem;">
                                ü§≥ Î≥¥Ìò∏Ïûê
                            </button>
                            <button onclick="switchBioCamera('environment')" id="bioCameraBack"
                                style="flex: 1; padding: 8px; background: rgba(45, 212, 191, 0.3); border: 1px solid rgba(45, 212, 191, 0.4); border-radius: 8px; color: var(--primary-light); cursor: pointer; font-weight: 600; font-size: 0.8rem;">
                                üê∂ Í∞ïÏïÑÏßÄ
                            </button>
                        </div>

                        <!-- Ïã§ÏãúÍ∞Ñ Ïπ¥Î©îÎùº Ïä§Ìä∏Î¶º -->
                        <video id="bioVideo"
                            style="width: 100%; height: 240px; background: #000; border-radius: 8px; margin-bottom: 12px; object-fit: cover; display: block; position: relative; z-index: 9999;"
                            autoplay playsinline webkit-playsinline muted></video>

                        <!-- ÏÉùÏ≤¥Ïä§Ï∫î Í≤∞Í≥º -->
                        <div id="bioResults" style="display: none;">
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 12px;">
                                <div
                                    style="background: rgba(239, 68, 68, 0.2); border: 1px solid rgba(239, 68, 68, 0.4); border-radius: 8px; padding: 12px; text-align: center;">
                                    <div style="font-size: 0.75rem; color: var(--text-muted); margin-bottom: 4px;">üíì
                                        Ïã¨Î∞ïÏàò</div>
                                    <div style="font-size: 1.5rem; color: #ef4444; font-weight: 700;" id="pulseResult">
                                        73</div>
                                    <div style="font-size: 0.7rem; color: var(--text-muted);">bpm (Ï∂îÏ†ï)</div>
                                </div>
                                <div
                                    style="background: rgba(34, 197, 94, 0.2); border: 1px solid rgba(34, 197, 94, 0.4); border-radius: 8px; padding: 12px; text-align: center;">
                                    <div style="font-size: 0.75rem; color: var(--text-muted); margin-bottom: 4px;">ü´Å Ìò∏Ìù°
                                    </div>
                                    <div style="font-size: 1.5rem; color: #22c55e; font-weight: 700;"
                                        id="respirationResult">31</div>
                                    <div style="font-size: 0.7rem; color: var(--text-muted);">/min (Ï∂îÏ†ï)</div>
                                </div>
                                <div
                                    style="background: rgba(249, 115, 22, 0.2); border: 1px solid rgba(249, 115, 22, 0.4); border-radius: 8px; padding: 12px; text-align: center;">
                                    <div style="font-size: 0.75rem; color: var(--text-muted); margin-bottom: 4px;">üå°Ô∏è
                                        Ï≤¥Ïò®</div>
                                    <div style="font-size: 1.5rem; color: #f97316; font-weight: 700;"
                                        id="temperatureResult">37.9</div>
                                    <div style="font-size: 0.7rem; color: var(--text-muted);">¬∞C (Ï∂îÏ†ï)</div>
                                </div>
                                <div
                                    style="background: rgba(168, 85, 247, 0.2); border: 1px solid rgba(168, 85, 247, 0.4); border-radius: 8px; padding: 12px; text-align: center;">
                                    <div style="font-size: 0.75rem; color: var(--text-muted); margin-bottom: 4px;">‚ö°
                                        Ïä§Ìä∏Î†àÏä§</div>
                                    <div style="font-size: 1.5rem; color: #a855f7; font-weight: 700;" id="stressResult">
                                        74</div>
                                    <div style="font-size: 0.7rem; color: var(--text-muted);">% (Ï∂îÏ†ï)</div>
                                </div>
                            </div>

                            <!-- AI Í≤ÄÏßÑ Î∂ÑÏÑù Í≤∞Í≥º -->
                            <div style="background: rgba(59, 130, 246, 0.2); border-left: 3px solid #3b82f6; border-radius: 8px; padding: 12px; margin-bottom: 12px; display: none;"
                                id="aiAnalysisResult">
                                <div
                                    style="font-size: 0.85rem; color: var(--text-muted); margin-bottom: 8px; font-weight: 600;">
                                    ü§ñ AI Í≤ÄÏßÑ Î∂ÑÏÑù</div>
                                <div id="aiAnalysisContent"
                                    style="font-size: 0.8rem; color: var(--text); line-height: 1.6;"></div>
                            </div>

                            <!-- Íµ¨Í∏Ä Í≤ÄÏÉâ Í≤∞Í≥º -->
                            <div style="background: rgba(16, 185, 129, 0.15); border-left: 3px solid #10b981; border-radius: 8px; padding: 12px; margin-bottom: 12px; display: none;"
                                id="googleSearchResult">
                                <div
                                    style="font-size: 0.85rem; color: var(--text-muted); margin-bottom: 8px; font-weight: 600;">
                                    üîç Í±¥Í∞ï Ï†ïÎ≥¥ Í≤ÄÏÉâ</div>
                                <div id="googleSearchContent"
                                    style="font-size: 0.8rem; color: var(--text); line-height: 1.6;"></div>
                                <div style="margin-top: 8px; font-size: 0.7rem; color: var(--text-muted);">
                                    <a href="#" id="googleSearchLink" target="_blank"
                                        style="color: #2dd4bf; text-decoration: underline;">ÏûêÏÑ∏Ìûà Î≥¥Í∏∞ ‚Üí</a>
                                </div>
                            </div>

                            <!-- Í≤∞Í≥º Ï†ÄÏû• Î≤ÑÌäº -->
                            <button onclick="saveBioAnalysisResults()"
                                style="width: 100%; padding: 10px; background: rgba(16, 185, 129, 0.2); border: 1px solid rgba(16, 185, 129, 0.4); border-radius: 8px; color: var(--primary-light); cursor: pointer; font-weight: 600; margin-bottom: 12px;">
                                üíæ Î∂ÑÏÑù Í≤∞Í≥º Ï†ÄÏû•
                            </button>
                        </div>
                    </div>

                    <!-- ÏÉùÏ≤¥Ïä§Ï∫î Ï†úÏñ¥ Î≤ÑÌäº -->
                    <div style="display: flex; gap: 8px; margin-bottom: 16px;">
                        <button class="btn-start start" id="btnStartBio" onclick="startBioScanAnalysis()"
                            style="flex: 1;">
                            ‚ñ∂Ô∏è ÏãúÏûë
                        </button>
                        <button class="btn-start stop" id="btnStopBio" onclick="stopBioScanAnalysis()"
                            style="flex: 1; display: none;">
                            ‚èπÔ∏è Ï¢ÖÎ£å
                        </button>
                    </div>

                    <!-- ÏÑºÏÑú Ïó∞Îèô UI -->
                    <div
                        style="background: rgba(100, 116, 139, 0.15); border: 1px solid rgba(100, 116, 139, 0.4); border-radius: 12px; padding: 14px; margin-bottom: 16px;">
                        <div style="font-size: 0.85rem; color: var(--text-muted); margin-bottom: 10px;">üîó ÌïòÎìúÏõ®Ïñ¥ ÏÑºÏÑú Ïó∞Îèô
                        </div>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                            <button onclick="showToast('‚è∞ Îã§Ïùå Î≤ÑÏ†ÑÏóêÏÑú ÏßÄÏõê ÏòàÏ†ïÏûÖÎãàÎã§', 'info')"
                                style="padding: 10px; background: rgba(45, 212, 191, 0.2); border: 1px solid rgba(45, 212, 191, 0.4); color: var(--primary-light); border-radius: 8px; font-size: 0.8rem; cursor: pointer; font-weight: 600;">
                                üëÇ Í∑ÄÍ±∏Ïù¥ ÏÑºÏÑú
                            </button>
                            <button onclick="showToast('‚è∞ Îã§Ïùå Î≤ÑÏ†ÑÏóêÏÑú ÏßÄÏõê ÏòàÏ†ïÏûÖÎãàÎã§', 'info')"
                                style="padding: 10px; background: rgba(45, 212, 191, 0.2); border: 1px solid rgba(45, 212, 191, 0.4); color: var(--primary-light); border-radius: 8px; font-size: 0.8rem; cursor: pointer; font-weight: 600;">
                                üìø Î™©Í±∏Ïù¥ ÏÑºÏÑú
                            </button>
                        </div>
                    </div>

                    <!-- ÏïàÎÇ¥Î¨∏ -->
                    <div
                        style="background: rgba(59, 130, 246, 0.15); border-left: 3px solid #3b82f6; border-radius: 8px; padding: 12px; margin-bottom: 16px; font-size: 0.85rem; color: var(--text-muted);">
                        <div style="margin-bottom: 4px;">üì± Í∏∞Í∏∞ ÏóÜÏù¥ÎèÑ AIÎ°ú ÏÉùÏ≤¥Î∂ÑÏÑùÌï©ÎãàÎã§</div>
                        <div style="font-size: 0.75rem;">Ïπ¥Î©îÎùº Í∏∞Î∞ò Î∂ÑÏÑùÏúºÎ°ú Ï†úÏïΩ ÏóÜÏù¥ ÏÇ¨Ïö© Í∞ÄÎä• ‚Ä¢ Ï†ïÌôïÎèÑÎäî Ïã§Ï†ú ÏùòÎ£åÍ∏∞Í∏∞ ÎåÄÎπÑ ÎÇÆÏùÑ Ïàò ÏûàÏäµÎãàÎã§</div>
                    </div>

                    <div
                        style="background: rgba(239, 68, 68, 0.15); border-left: 3px solid #ef4444; border-radius: 8px; padding: 12px; font-size: 0.85rem; color: var(--text-muted);">
                        <div style="margin-bottom: 4px;">‚ö†Ô∏è ÏùòÎ£åÍ∏∞Í∏∞Í∞Ä ÏïÑÎãôÎãàÎã§</div>
                        <div style="font-size: 0.75rem;">Ï†ïÌôïÌïú ÏßÑÎã®ÏùÑ ÏúÑÌï¥ ÏàòÏùòÏÇ¨ ÏÉÅÎã¥ÏùÑ Í∂åÏû•Ìï©ÎãàÎã§ ‚Ä¢ Ïù¥ ÏÑúÎπÑÏä§Îäî ÏùºÎ∞ò Ï†ïÎ≥¥ Ï†úÍ≥µÏö©ÏûÖÎãàÎã§</div>
                    </div>
                </div>
            </div>
            <div
                style="background: rgba(249, 115, 22, 0.2); border: 1px solid rgba(249, 115, 22, 0.4); border-radius: 8px; padding: 12px; text-align: center;">
                <div style="font-size: 0.75rem; color: var(--text-muted); margin-bottom: 4px;">üå°Ô∏è Ï≤¥Ïò®</div>
                <div style="font-size: 1.5rem; color: #f97316; font-weight: 700;" id="temperatureResult">37.9</div>
                <div style="font-size: 0.7rem; color: var(--text-muted);">¬∞C (Ï∂îÏ†ï)</div>
            </div>
            <div
                style="background: rgba(168, 85, 247, 0.2); border: 1px solid rgba(168, 85, 247, 0.4); border-radius: 8px; padding: 12px; text-align: center;">
                <div style="font-size: 0.75rem; color: var(--text-muted); margin-bottom: 4px;">‚ö° Ïä§Ìä∏Î†àÏä§</div>
                <div style="font-size: 1.5rem; color: #a855f7; font-weight: 700;" id="stressResult">74</div>
                <div style="font-size: 0.7rem; color: var(--text-muted);">% (Ï∂îÏ†ï)</div>
            </div>
            </div>
            </div>
            </div>

            <!-- ÏÑºÏÑú Ïó∞Îèô UI -->
            <div
                style="background: rgba(100, 116, 139, 0.15); border: 1px solid rgba(100, 116, 139, 0.4); border-radius: 12px; padding: 14px; margin-bottom: 16px;">
                <div style="font-size: 0.85rem; color: var(--text-muted); margin-bottom: 10px;">üîó ÌïòÎìúÏõ®Ïñ¥ ÏÑºÏÑú Ïó∞Îèô</div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                    <button onclick="showToast('‚è∞ Îã§Ïùå Î≤ÑÏ†ÑÏóêÏÑú ÏßÄÏõê ÏòàÏ†ïÏûÖÎãàÎã§', 'info')"
                        style="padding: 10px; background: rgba(45, 212, 191, 0.2); border: 1px solid rgba(45, 212, 191, 0.4); color: var(--primary-light); border-radius: 8px; font-size: 0.8rem; cursor: pointer; font-weight: 600;">
                        üëÇ Í∑ÄÍ±∏Ïù¥ ÏÑºÏÑú
                    </button>
                    <button onclick="showToast('‚è∞ Îã§Ïùå Î≤ÑÏ†ÑÏóêÏÑú ÏßÄÏõê ÏòàÏ†ïÏûÖÎãàÎã§', 'info')"
                        style="padding: 10px; background: rgba(45, 212, 191, 0.2); border: 1px solid rgba(45, 212, 191, 0.4); color: var(--primary-light); border-radius: 8px; font-size: 0.8rem; cursor: pointer; font-weight: 600;">
                        üìø Î™©Í±∏Ïù¥ ÏÑºÏÑú
                    </button>
                </div>
            </div>

            <!-- ÏÉùÏ≤¥Ïä§Ï∫î Ï†úÏñ¥ Î≤ÑÌäº -->
            <div style="display: flex; gap: 8px; margin-bottom: 16px;">
                <button class="btn-start start" id="btnStartBio" onclick="startBioScanAnalysis()" style="flex: 1;">
                    ‚ñ∂Ô∏è ÏãúÏûë
                </button>
                <button class="btn-start stop" id="btnStopBio" onclick="stopBioScanAnalysis()"
                    style="flex: 1; display: none;">
                    ‚èπÔ∏è Ï¢ÖÎ£å
                </button>
            </div>

            <!-- Í±¥Í∞ï Í∏∞Í∏∞ Ïó∞Îèô ÏïàÎÇ¥ -->
            <div
                style="background: rgba(59, 130, 246, 0.15); border-left: 3px solid #3b82f6; border-radius: 8px; padding: 12px; margin-bottom: 16px; font-size: 0.85rem; color: var(--text-muted);">
                <div style="margin-bottom: 4px;">üì± Í∏∞Í∏∞ ÏóÜÏù¥ÎèÑ AIÎ°ú ÏÉùÏ≤¥Î∂ÑÏÑùÌï©ÎãàÎã§</div>
                <div style="font-size: 0.75rem;">Ïπ¥Î©îÎùº Í∏∞Î∞ò Î∂ÑÏÑùÏúºÎ°ú Ï†úÏïΩ ÏóÜÏù¥ ÏÇ¨Ïö© Í∞ÄÎä• ‚Ä¢ Ï†ïÌôïÎèÑÎäî Ïã§Ï†ú ÏùòÎ£åÍ∏∞Í∏∞ ÎåÄÎπÑ ÎÇÆÏùÑ Ïàò ÏûàÏäµÎãàÎã§</div>
            </div>

            <div
                style="background: rgba(239, 68, 68, 0.15); border-left: 3px solid #ef4444; border-radius: 8px; padding: 12px; font-size: 0.85rem; color: var(--text-muted);">
                <div style="margin-bottom: 4px;">‚ö†Ô∏è ÏùòÎ£åÍ∏∞Í∏∞Í∞Ä ÏïÑÎãôÎãàÎã§</div>
                <div style="font-size: 0.75rem;">Ï†ïÌôïÌïú ÏßÑÎã®ÏùÑ ÏúÑÌï¥ ÏàòÏùòÏÇ¨ ÏÉÅÎã¥ÏùÑ Í∂åÏû•Ìï©ÎãàÎã§ ‚Ä¢ Ïù¥ ÏÑúÎπÑÏä§Îäî ÏùºÎ∞ò Ï†ïÎ≥¥ Ï†úÍ≥µÏö©ÏûÖÎãàÎã§</div>
            </div>
            </div>

            <!-- ÌéÑÏä§ ÏÑºÏÑú Î™®Îìú -->
            <div id="pulseMode" style="display: none;">
                <div style="margin-bottom: 16px;">
                    <div style="font-size: 0.85rem; color: var(--text-muted); margin-bottom: 8px;">üéöÔ∏è ÏùåÏÑ± Î†àÎ≤® Î∂ÑÏÑù</div>
                    <div class="meter-bar">
                        <div class="meter-fill" id="healthMeterFill"></div>
                    </div>
                </div>

                <div class="health-stats">
                    <div class="stat-item">
                        <div class="stat-label">ÏÉÅÌÉú</div>
                        <div class="stat-value" id="healthState">ÎåÄÍ∏∞</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">ÎÇ®ÏùÄ ÏãúÍ∞Ñ</div>
                        <div class="stat-value" id="healthTime">30s</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">ÌèâÍ∑† Î†àÎ≤®</div>
                        <div class="stat-value" id="healthAvg">0.000</div>
                    </div>
                </div>

                <div id="healthResults" style="display: none; margin-top: 16px;">
                    <div
                        style="background: rgba(16, 185, 129, 0.15); border: 1px solid rgba(16, 185, 129, 0.4); border-radius: 12px; padding: 16px;">
                        <div style="font-size: 0.85rem; color: var(--text-muted); margin-bottom: 8px;">‚úÖ Í±¥Í∞ï ÌèâÍ∞Ä</div>
                        <div id="healthComment" style="font-size: 1rem; color: var(--primary-light); font-weight: 600;">
                        </div>
                        <div style="font-size: 0.75rem; color: var(--text-muted); margin-top: 8px;">
                            <div id="healthDetails"></div>
                        </div>
                    </div>
                </div>

                <button class="btn-track" id="btnViewRecords" onclick="viewHealthRecords()" style="margin-top: 16px;">
                    üìã Í±¥Í∞ï Í∏∞Î°ù Î≥¥Í∏∞
                </button>

                <div id="recordsList" style="display: none; margin-top: 16px; max-height: 300px; overflow-y: auto;">
                    <div style="font-size: 0.85rem; color: var(--text-muted); margin-bottom: 12px;">üìä ÏµúÍ∑º Í∏∞Î°ù (ÏµúÎåÄ 10Í∞ú)
                    </div>
                    <div id="recordsContainer"></div>
                </div>
            </div>
            </div>
        </section>

        <!-- ÏúÑÏπò Ï∂îÏ†Å ÏÑπÏÖò -->
        <section id="locate" class="section">
            <div class="main-card">
                <div class="section-title">üìç Î∞òÎ†§ÎèôÎ¨º ÏúÑÏπò Ï∂îÏ†Å</div>
                <p style="color: var(--text-muted); font-size: 0.85rem; margin-bottom: 12px;">
                    GPSÎ•º ÏÇ¨Ïö©ÌïòÏó¨ Î∞òÎ†§ÎèôÎ¨ºÏùò ÌòÑÏû¨ ÏúÑÏπòÏôÄ Ïù¥Îèô Í≤ΩÎ°úÎ•º Ï∂îÏ†ÅÌï©ÎãàÎã§.
                </p>

                <!-- ÏúÑÏπò Ï†ïÎ≥¥ -->
                <div class="location-info">
                    <div class="location-item">
                        <span class="location-label">üìç ÌòÑÏû¨ ÏúÑÎèÑ</span>
                        <span class="location-value" id="latValue">ÎåÄÍ∏∞Ï§ë...</span>
                    </div>
                    <div class="location-item">
                        <span class="location-label">üìç ÌòÑÏû¨ Í≤ΩÎèÑ</span>
                        <span class="location-value" id="lonValue">ÎåÄÍ∏∞Ï§ë...</span>
                    </div>
                    <div class="location-item">
                        <span class="location-label">üìè Ï†ïÌôïÎèÑ</span>
                        <span class="location-value" id="accValue">--</span>
                    </div>
                    <div class="location-item">
                        <span class="location-label">üöó Ïù¥Îèô ÏÜçÎèÑ</span>
                        <span class="location-value" id="speedValue">--</span>
                    </div>
                </div>

                <!-- ÏßÄÎèÑ -->
                <div id="mapContainer"></div>

                <!-- Ïª®Ìä∏Î°§ Î≤ÑÌäº -->
                <button class="btn-track" id="btnTrack" onclick="startTracking()">
                    üìç ÏúÑÏπò Ï∂îÏ†Å ÏãúÏûë
                </button>
                <button class="btn-track stop" id="btnTrackStop" onclick="stopTracking()" style="display: none;">
                    ‚èπ Ï∂îÏ†Å Ï§ëÏßÄ
                </button>

                <!-- ÏúÑÏπò ÌûàÏä§ÌÜ†Î¶¨ -->
                <div style="margin-top: 16px;">
                    <div class="section-title">üìã ÏúÑÏπò ÌûàÏä§ÌÜ†Î¶¨</div>
                    <div class="location-history" id="locationHistory">
                        <div style="color: var(--text-muted); text-align: center; padding: 20px;">
                            Ï∂îÏ†ÅÏùÑ ÏãúÏûëÌïòÎ©¥ ÏúÑÏπò Í∏∞Î°ùÏù¥ ÌëúÏãúÎê©ÎãàÎã§.
                        </div>
                    </div>
                </div>

                <!-- Î≤ÑÌäº Î™®Ïùå -->
                <div style="display: flex; gap: 8px; margin-top: 16px;">
                    <button class="btn-start" onclick="exportLocationData()"
                        style="flex: 1; background: rgba(16, 185, 129, 0.2); color: var(--primary-light); border: 1px solid var(--primary);">
                        üíæ ÏúÑÏπò Ï†ÄÏû•
                    </button>
                    <button class="btn-start" onclick="clearLocationHistory()"
                        style="flex: 1; background: rgba(239, 68, 68, 0.2); color: #f87171; border: 1px solid var(--danger);">
                        üóëÔ∏è Í∏∞Î°ù ÏÇ≠Ï†ú
                    </button>
                </div>
            </div>
        </section>
    </main>

    <!-- Ìë∏ÌÑ∞ -->
    <footer>
        <p>¬© 2026 <a href="https://petctt.com">PetCTT Pro</a> - Î∞òÎ†§ÎèôÎ¨º ÌÜµÏó≠ + ÏúÑÏπò Ï∂îÏ†Å</p>
        <p style="margin-top:4px">Í∞ïÏïÑÏßÄÎ•º ÏûÉÏñ¥Î≤ÑÎ†∏ÏùÑ Îïå GPSÎ°ú Ï∞æÏïÑÏ£ºÏÑ∏Ïöî üêæ</p>
    </footer>

    <!-- ÌÜ†Ïä§Ìä∏ -->
    <div class="toast" id="toast"></div>

    <!-- ÏÑ§Ï†ï Î™®Îã¨ -->
    <!-- Î∞©ÏÜ°Íµ≠ Î™®Îã¨ -->
    <div class="modal-overlay" id="broadcastModal">
        <div class="modal" style="max-width: 400px;">
            <button class="modal-close" onclick="closeBroadcastStation()">‚úï</button>
            <h3 class="modal-title">üì° PetCTT Î∞©ÏÜ°Íµ≠</h3>

            <div
                style="margin-bottom: 16px; padding: 12px; background: rgba(45, 212, 191, 0.15); border-radius: 8px; border: 1px solid rgba(45, 212, 191, 0.3);">
                <div style="font-size: 0.9rem; color: var(--text); font-weight: 600; margin-bottom: 8px;">üé¨ ÎùºÏù¥Î∏å Î∞©ÏÜ° Ï±ÑÎÑê
                </div>
                <div style="font-size: 0.75rem; color: var(--text-muted);">Î∞òÎ†§ÎèôÎ¨º Í±¥Í∞ï Ï†ïÎ≥¥ÏôÄ Í∞êÏ†ïÎ∂ÑÏÑù Í≤∞Í≥ºÎ•º Ïã§ÏãúÍ∞Ñ Î∞©ÏÜ°Ìï©ÎãàÎã§</div>
            </div>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 16px;">
                <button onclick="selectBroadcastCategory('medical')" class="broadcast-category-btn"
                    data-category="medical"
                    style="padding: 12px; background: rgba(239, 68, 68, 0.2); border: 1px solid rgba(239, 68, 68, 0.4); border-radius: 8px; color: #fca5a5; cursor: pointer; font-weight: 600; font-size: 0.85rem;">
                    üè• ÏùòÌïôÏÉÅÎã¥
                </button>
                <button onclick="selectBroadcastCategory('news')" class="broadcast-category-btn" data-category="news"
                    style="padding: 12px; background: rgba(59, 130, 246, 0.2); border: 1px solid rgba(59, 130, 246, 0.4); border-radius: 8px; color: #93c5fd; cursor: pointer; font-weight: 600; font-size: 0.85rem;">
                    üì∞ Îâ¥Ïä§
                </button>
                <button onclick="selectBroadcastCategory('audition')" class="broadcast-category-btn"
                    data-category="audition"
                    style="padding: 12px; background: rgba(168, 85, 247, 0.2); border: 1px solid rgba(168, 85, 247, 0.4); border-radius: 8px; color: #d8b4fe; cursor: pointer; font-weight: 600; font-size: 0.85rem;">
                    üé§ Ïò§ÎîîÏÖò
                </button>
                <button onclick="selectBroadcastCategory('exploration')" class="broadcast-category-btn"
                    data-category="exploration"
                    style="padding: 12px; background: rgba(249, 115, 22, 0.2); border: 1px solid rgba(249, 115, 22, 0.4); border-radius: 8px; color: #fed7aa; cursor: pointer; font-weight: 600; font-size: 0.85rem;">
                    üîç ÌÉêÏÇ¨
                </button>
                <button onclick="selectBroadcastCategory('shopping')" class="broadcast-category-btn"
                    data-category="shopping"
                    style="padding: 12px; background: rgba(34, 197, 94, 0.2); border: 1px solid rgba(34, 197, 94, 0.4); border-radius: 8px; color: #86efac; cursor: pointer; font-weight: 600; font-size: 0.85rem;">
                    üõçÔ∏è ÏáºÌïë
                </button>
                <button onclick="selectBroadcastCategory('global')" class="broadcast-category-btn"
                    data-category="global"
                    style="padding: 12px; background: rgba(99, 102, 241, 0.2); border: 1px solid rgba(99, 102, 241, 0.4); border-radius: 8px; color: #c7d2fe; cursor: pointer; font-weight: 600; font-size: 0.85rem;">
                    üåç Í∏ÄÎ°úÎ≤å
                </button>
            </div>

            <div id="broadcastInfo"
                style="background: rgba(0, 0, 0, 0.2); border-radius: 8px; padding: 12px; margin-bottom: 16px; display: none;">
                <div style="font-size: 0.9rem; color: var(--text); margin-bottom: 4px;" id="selectedCategoryTitle">
                </div>
                <div style="font-size: 0.75rem; color: var(--text-muted);" id="selectedCategoryDesc"></div>
            </div>

            <button class="modal-save" onclick="startBroadcast()" style="width: 100%; margin-bottom: 8px;">
                üé¨ Î∞©ÏÜ° ÏãúÏûë
            </button>
            <button class="modal-save"
                style="width: 100%; background: rgba(45, 212, 191, 0.2); border: 1px solid rgba(45, 212, 191, 0.4); color: var(--primary-light);"
                onclick="closeBroadcastStation()">
                Ï∑®ÏÜå
            </button>
        </div>
    </div>

    <div class="modal-overlay" id="settingsModal">
        <div class="modal">
            <button class="modal-close" onclick="closeSettings()">‚úï</button>
            <h3 class="modal-title">‚öôÔ∏è ÌÜµÏó≠ ÏÑ§Ï†ï</h3>

            <div class="setting-item">
                <div class="setting-label">
                    <span>üîä ÏùåÏÑ± ÏÜçÎèÑ</span>
                    <span class="setting-value" id="rateValue">1.0x</span>
                </div>
                <input type="range" id="speechRate" min="0.5" max="2" step="0.1" value="1" oninput="updateRateValue()">
            </div>

            <div class="setting-item">
                <div class="setting-label">
                    <span>üéµ ÏùåÏÑ± ÌÜ§</span>
                    <span class="setting-value" id="pitchValue">1.0</span>
                </div>
                <input type="range" id="speechPitch" min="0.5" max="2" step="0.1" value="1"
                    oninput="updatePitchValue()">
            </div>

            <div class="setting-item">
                <div class="setting-label">
                    <span>üì¢ Î≥ºÎ•®</span>
                    <span class="setting-value" id="volumeValue">100%</span>
                </div>
                <input type="range" id="speechVolume" min="0" max="1" step="0.1" value="1"
                    oninput="updateVolumeValue()">
            </div>

            <button class="modal-save" onclick="closeSettings()">Ï†ÄÏû•ÌïòÍ∏∞</button>
        </div>
    </div>

    <script>
        // ==========================================
        // ÏúÑÏπò Ï∂îÏ†Å Í∏∞Îä•
        // ==========================================
        var locationData = {
            tracking: false,
            history: JSON.parse(localStorage.getItem('petctt_locations') || '[]'),
            watchId: null,
            map: null,
            markers: []
        };

        function initMap() {
            if (locationData.map) return;
            locationData.map = L.map('mapContainer').setView([37.5665, 126.9780], 15);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '¬© OpenStreetMap contributors',
                maxZoom: 19
            }).addTo(locationData.map);
        }

        async function startTracking() {
            if (locationData.tracking) return;

            if (!navigator.geolocation) {
                showToast('Ïù¥ Í∏∞Í∏∞Îäî ÏúÑÏπò Í∏∞Îä•ÏùÑ ÏßÄÏõêÌïòÏßÄ ÏïäÏäµÎãàÎã§', 'error');
                return;
            }

            locationData.tracking = true;
            document.getElementById('btnTrack').style.display = 'none';
            document.getElementById('btnTrackStop').style.display = 'block';

            initMap();
            showToast('üìç ÏúÑÏπò Ï∂îÏ†Å ÏãúÏûë!', 'success');

            locationData.watchId = navigator.geolocation.watchPosition(
                function (position) {
                    var lat = position.coords.latitude;
                    var lon = position.coords.longitude;
                    var accuracy = Math.round(position.coords.accuracy);
                    var speed = position.coords.speed ? Math.round(position.coords.speed * 3.6) : null;

                    updateLocationUI(lat, lon, accuracy, speed);
                    saveLocationPoint(lat, lon, accuracy, speed);
                    updateMapMarker(lat, lon);
                },
                function (error) {
                    showToast('ÏúÑÏπò Ï†ëÍ∑º Ïã§Ìå®: ' + error.message, 'error');
                    stopTracking();
                },
                { enableHighAccuracy: true, maximumAge: 0, timeout: 5000 }
            );
        }

        function stopTracking() {
            if (locationData.watchId) {
                navigator.geolocation.clearWatch(locationData.watchId);
                locationData.watchId = null;
            }
            locationData.tracking = false;
            document.getElementById('btnTrack').style.display = 'block';
            document.getElementById('btnTrackStop').style.display = 'none';
            showToast('‚èπ ÏúÑÏπò Ï∂îÏ†Å Ï§ëÏßÄ', 'info');
        }

        function updateLocationUI(lat, lon, accuracy, speed) {
            document.getElementById('latValue').textContent = lat.toFixed(6);
            document.getElementById('lonValue').textContent = lon.toFixed(6);
            document.getElementById('accValue').textContent = accuracy + 'm';
            document.getElementById('speedValue').textContent = speed ? speed + ' km/h' : '--';
        }

        function saveLocationPoint(lat, lon, accuracy, speed) {
            var point = {
                lat: lat,
                lon: lon,
                accuracy: accuracy,
                speed: speed,
                timestamp: new Date().toLocaleString('ko-KR')
            };

            locationData.history.push(point);
            if (locationData.history.length > 100) {
                locationData.history.shift();
            }

            localStorage.setItem('petctt_locations', JSON.stringify(locationData.history));
            updateLocationHistory();
        }

        function updateMapMarker(lat, lon) {
            locationData.map.setView([lat, lon], 15);

            locationData.markers.forEach(m => locationData.map.removeLayer(m));
            locationData.markers = [];

            locationData.history.forEach((point, idx) => {
                var marker = L.circleMarker([point.lat, point.lon], {
                    radius: idx === locationData.history.length - 1 ? 8 : 5,
                    color: idx === locationData.history.length - 1 ? '#ef4444' : '#10b981',
                    fill: true,
                    fillColor: idx === locationData.history.length - 1 ? '#ef4444' : '#10b981',
                    fillOpacity: 0.7,
                    weight: 2
                }).addTo(locationData.map)
                    .bindPopup('#' + (idx + 1) + ' - ' + point.timestamp);

                locationData.markers.push(marker);
            });

            if (locationData.history.length > 1) {
                var polyline = L.polyline(
                    locationData.history.map(p => [p.lat, p.lon]),
                    { color: '#10b981', weight: 2, opacity: 0.6, dashArray: '5, 5' }
                ).addTo(locationData.map);
                locationData.markers.push(polyline);
            }
        }

        function updateLocationHistory() {
            var html = '';
            if (locationData.history.length === 0) {
                html = '<div style="color: var(--text-muted); text-align: center; padding: 20px;">ÏúÑÏπò Í∏∞Î°ùÏù¥ ÏóÜÏäµÎãàÎã§.</div>';
            } else {
                html = locationData.history.map((point, idx) => `
                <div class="history-item">
                    <div class="history-time">üìå ${point.timestamp}</div>
                    <div class="history-coords">${point.lat.toFixed(4)}, ${point.lon.toFixed(4)}</div>
                    <small style="color: var(--text-muted);">Ï†ïÌôïÎèÑ: ${point.accuracy}m ${point.speed ? '¬∑ ÏÜçÎèÑ: ' + point.speed + 'km/h' : ''}</small>
                </div>
            `).reverse().join('');
            }
            document.getElementById('locationHistory').innerHTML = html;
        }

        function exportLocationData() {
            if (locationData.history.length === 0) {
                showToast('Ï†ÄÏû•Ìï† ÏúÑÏπò Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§', 'error');
                return;
            }

            var csv = 'ÏàúÎ≤à,ÏãúÍ∞Ñ,ÏúÑÎèÑ,Í≤ΩÎèÑ,Ï†ïÌôïÎèÑ(m),ÏÜçÎèÑ(km/h)\n';
            locationData.history.forEach((p, i) => {
                csv += (i + 1) + ',' + p.timestamp + ',' + p.lat + ',' + p.lon + ',' + p.accuracy + ',' + (p.speed || '') + '\n';
            });

            var blob = new Blob([csv], { type: 'text/csv;charset=utf-8' });
            var url = URL.createObjectURL(blob);
            var a = document.createElement('a');
            a.href = url;
            a.download = 'petctt_locations_' + new Date().getTime() + '.csv';
            document.body.appendChild(a);
            a.click();
            a.remove();

            showToast('üíæ ÏúÑÏπò Îç∞Ïù¥ÌÑ∞ Ï†ÄÏû• ÏôÑÎ£å!', 'success');
        }

        function clearLocationHistory() {
            if (confirm('Ï†ÄÏû•Îêú Î™®Îì† ÏúÑÏπò Îç∞Ïù¥ÌÑ∞Î•º ÏÇ≠Ï†úÌï†ÍπåÏöî?')) {
                locationData.history = [];
                localStorage.removeItem('petctt_locations');
                updateLocationHistory();
                if (locationData.map) {
                    locationData.markers.forEach(m => locationData.map.removeLayer(m));
                    locationData.markers = [];
                }
                showToast('üóëÔ∏è ÏúÑÏπò Îç∞Ïù¥ÌÑ∞ ÏÇ≠Ï†úÎê®', 'success');
            }
        }

        // ÌÉ≠ Ïä§ÏúÑÏπ≠
        document.addEventListener('DOMContentLoaded', function () {
            document.querySelectorAll('.tab-btn').forEach(function (btn) {
                btn.addEventListener('click', function () {
                    var tab = this.dataset.tab;
                    document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                    document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
                    this.classList.add('active');
                    document.getElementById(tab).classList.add('active');

                    if (tab === 'locate') {
                        setTimeout(() => {
                            if (locationData.map) locationData.map.invalidateSize();
                            updateLocationHistory();
                        }, 100);
                    }
                });
            });
        });

        // Ï¥àÍ∏∞ Î°úÎìú
        document.addEventListener('DOMContentLoaded', updateLocationHistory);

        // ===== ÎèôÎ¨º ÎåÄÌôî ÏÉÅÌÉú Í¥ÄÎ¶¨ =====
        var liveState = {
            live: false,
            isRecording: false,
            recognizing: false,
            speaking: false,
            motionRunning: false,
            cameraStream: null,
            emotionInterval: null
        };

        var selectedAnimal = 'dog';
        var recognition = null;
        var learningData = JSON.parse(localStorage.getItem('petctt_learning') || '{"count":0,"accuracy":12.5}');

        var ANIMALS = {
            dog: {
                icon: 'üê∂',
                name: 'Í∞ïÏïÑÏßÄ',
                sounds: ['Î©çÎ©ç!', 'ÏôàÏôà!', 'ÎÇëÎÇë~', 'ÏúºÎ•¥Î†Å', 'ÌÇÅÌÇÅ'],
                pitch: 1.0
            },
            cat: {
                icon: 'üê±',
                name: 'Í≥†ÏñëÏù¥',
                sounds: ['ÏïºÏòπ~', 'ÎÉêÏòπ!', 'Í∑∏Î•¥Î¶â', 'ÌïòÏïÖ!', 'ÎØ∏Ïïº~'],
                pitch: 1.3
            },
            chick: {
                icon: 'üê•',
                name: 'Î≥ëÏïÑÎ¶¨',
                sounds: ['ÏÇêÏïΩÏÇêÏïΩ!', 'ÏÇêÏÇê!', 'ÏÇêÏù¥Ïùµ~', 'Ï™ºÏ™ºÏ™º'],
                pitch: 1.6
            }
        };

        var ANIMAL_TO_HUMAN = {
            dog: {
                happy: ['ÎÑàÎ¨¥ Ï¢ãÏïÑÏöî! Ïã†ÎÇòÏöî!', 'ÏÇ¨ÎûëÌï¥Ïöî Î≥¥Ìò∏ÏûêÎãò!', 'ÎÜÄÏïÑÏ£ºÏÑ∏Ïöî!'],
                hungry: ['Î∞∞Í≥†ÌååÏöî... Î∞• Ï£ºÏÑ∏Ïöî', 'Í∞ÑÏãù Î®πÍ≥† Ïã∂Ïñ¥Ïöî!'],
                anxious: ['Î¨¥ÏÑúÏõåÏöî... Í≥ÅÏóê ÏûàÏñ¥Ï£ºÏÑ∏Ïöî', 'Î∂àÏïàÌï¥Ïöî...'],
                alert: ['ÎàÑÍ∞Ä ÏôîÏñ¥Ïöî!', 'Ï°∞Ïã¨ÌïòÏÑ∏Ïöî!', 'ÏßÄÌÇ¨Í≤åÏöî!'],
                love: ['Î≥¥Ìò∏ÏûêÎãò Ï¢ãÏïÑÌï¥Ïöî~', 'Ïì∞Îã§Îì¨Ïñ¥ Ï£ºÏÑ∏Ïöî', 'ÌñâÎ≥µÌï¥Ïöî!']
            },
            cat: {
                happy: ['Í∏∞Î∂Ñ Ï¢ãÏïÑÏöî~', 'Í∑∏Î•¥Î¶â... ÌñâÎ≥µÌï¥', 'ÎÜÄÏïÑÏ§òÏöî~'],
                hungry: ['Î∞• Ï£ºÏÑ∏Ïöî ÎÉ•', 'Í∞ÑÏãù ÏãúÍ∞ÑÏù¥ÏóêÏöî', 'Î∞∞Í≥†ÌååÏöî ÎÉ•'],
                anxious: ['Î¨¥ÏÑúÏõåÏöî... Ïà®ÏùÑ Í≥≥ ÌïÑÏöîÌï¥Ïöî', 'Î∂àÏïàÌï¥Ïöî ÎÉ•...'],
                alert: ['Ï†ÄÍ±∞ Î≠êÏïº?', 'ÎÇ¥ ÏòÅÏó≠Ïù¥Ïïº!', 'Ï†ëÍ∑ºÌïòÏßÄ Îßà!'],
                love: ['Í∞ôÏù¥ ÏûàÍ≥† Ïã∂Ïñ¥Ïöî ÎÉ•~', 'ÏÇ¨ÎûëÌï¥Ïöî ÏßëÏÇ¨Îãò', 'Í∑∏Î•¥Î¶â~']
            },
            chick: {
                happy: ['ÏÇêÏïΩ! Ïã†ÎÇòÏöî!', 'Îî∞ÎúªÌï¥ÏÑú Ï¢ãÏïÑÏöî!', 'ÏπúÍµ¨Îì§Ïù¥Îûë ÎÜÄÍ≥† Ïã∂Ïñ¥Ïöî!'],
                hungry: ['Î∞∞Í≥†ÌååÏöî ÏÇêÏïΩ!', 'Î™®Ïù¥ Ï£ºÏÑ∏Ïöî~'],
                anxious: ['ÏóÑÎßà Ïñ¥ÎîîÏûàÏñ¥Ïöî?', 'Î¨¥ÏÑúÏõåÏöî ÏÇêÏïΩ...', 'ÌòºÏûê ÎëêÏßÄ ÎßàÏÑ∏Ïöî'],
                alert: ['ÏúÑÌóòÌï¥Ïöî!', 'ÌïòÎäòÏóêÏÑú Î≠îÍ∞Ä ÏôÄÏöî!'],
                love: ['Îî∞ÎúªÌï¥Ïöî~', 'Í∞ôÏù¥ ÏûàÍ≥† Ïã∂Ïñ¥Ïöî', 'Î≥¥Ìò∏ÏûêÎãò Ï¢ãÏïÑÏöî ÏÇêÏïΩ!']
            }
        };

        var HUMAN_KEYWORDS = {
            'Í¥úÏ∞ÆÏïÑ': { emotion: 'comfort', responses: { dog: 'Íº¨Î¶¨ ÏÇ¥ÎûëÏÇ¥Îûë~ (ÏïàÏã¨ÌñàÏñ¥Ïöî!)', cat: 'Í∑∏Î•¥Î¶â~ (ÏïåÍ≤†Ïñ¥Ïöî ÎÉ•)', chick: 'ÏÇêÏïΩ~ (ÏïàÏã¨Ïù¥ÏóêÏöî!)' } },
            'ÏÇ¨ÎûëÌï¥': { emotion: 'love', responses: { dog: 'Íº¨Î¶¨ ÌùîÎì§ÌùîÎì§~ Î©ç! (ÎÇòÎèÑÏöî!)', cat: 'Í∑∏Î•¥Î¶âÍ∑∏Î•¥Î¶â... (ÎÇòÎèÑ ÎÉ•)', chick: 'ÏÇêÏÇêÏÇê~ (Ï¢ãÏïÑÏöî!)' } },
            'Î∞•': { emotion: 'food', responses: { dog: 'Î©çÎ©ç! Íº¨Î¶¨ Ìå°Ìå°! (Î∞•Ïù¥Îã§!)', cat: 'ÎÉêÏòπ! ÎÉêÏòπ! (Î∞•Ïù¥Îã§ ÎÉ•!)', chick: 'ÏÇêÏïΩ! ÏÇêÏù¥Ïùµ! (Î™®Ïù¥Îã§!)' } },
            'Í∞ÑÏãù': { emotion: 'treat', responses: { dog: 'ÏôàÏôà! Îàà Î∞òÏßù (Í∞ÑÏãù Ï¢ãÏïÑ!)', cat: 'ÏïºÏòπ~ Íº¨Î¶¨ ÏÑ∏ÏõÄ (Í∏∞ÎåÄÎêúÎã§ ÎÉ•)', chick: 'ÏÇêÏïΩÏÇêÏïΩ! (ÎßõÏûàÍ≤†Îã§!)' } },
            'ÏÇ∞Ï±Ö': { emotion: 'walk', responses: { dog: 'ÏôàÏôàÏôà! Îõ∞Ïñ¥Îã§Îãò (ÏÇ∞Ï±Ö Ï¢ãÏïÑ!)', cat: '...Ìù• (Í∑ÄÏ∞ÆÎã§ ÎÉ•)', chick: 'ÏÇêÏïΩ? (Î∞ñÏù¥Ïöî?)' } },
            'ÏûòÌñàÏñ¥': { emotion: 'praise', responses: { dog: 'Íº¨Î¶¨ ÌùîÎì§ÌùîÎì§~ ÎÇëÎÇë (Í∏∞ÎªêÏöî!)', cat: 'Í∑∏Î•¥Î¶â~ (ÎãπÏó∞ÌïòÏßÄ ÎÉ•)', chick: 'ÏÇêÏÇê! (Í≥†ÎßàÏõåÏöî!)' } },
            'ÎÜÄÏûê': { emotion: 'play', responses: { dog: 'Î©ç! ÏôàÏôà! Îõ∞Ïñ¥Îã§Îãò (Ïã†ÎÇò!)', cat: 'ÎÉêÏïô~ Îàà ÎèôÍ∑∏ÎûòÏßê (ÎÜÄÏïÑÏ§ò ÎÉ•!)', chick: 'ÏÇêÏïΩÏÇêÏïΩ! (Í∞ôÏù¥ ÎÜÄÏïÑÏöî!)' } },
            'ÏòàÎªê': { emotion: 'compliment', responses: { dog: 'Íº¨Î¶¨ ÏÇ¥Îûë~ (Í≥†ÎßàÏõåÏöî!)', cat: 'Í∑∏Î•¥Î¶â (ÏïåÍ≥† ÏûàÏñ¥ ÎÉ•)', chick: 'ÏÇê~ (Í∏∞ÎªêÏöî!)' } },
            'Ïù¥Î¶¨ÏôÄ': { emotion: 'come', responses: { dog: 'Îã¨Î†§Ïò¥~ Î©ç! (Í∞ÄÏöî!)', cat: '...Ï≤úÏ≤úÌûà Í±∏Ïñ¥Ïò¥ (Í∑ÄÏ∞ÆÏßÄÎßå ÎÉ•)', chick: 'ÏÇêÏïΩÏÇêÏïΩ! Îã¨Î†§Ïò¥ (Í∞ÄÏöî!)' } }
        };

        // Ï¥àÍ∏∞Ìôî
        document.addEventListener('DOMContentLoaded', function () {
            initSpeechRecognition();
            updateLearningUI();
            // loadSettings Ìï®ÏàòÍ∞Ä ÏóÜÏúºÎØÄÎ°ú Ï£ºÏÑù Ï≤òÎ¶¨
        });

        function initSpeechRecognition() {
            var SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            if (!SpeechRecognition) return;

            recognition = new SpeechRecognition();
            recognition.lang = 'ko-KR';
            recognition.interimResults = false;
            recognition.maxAlternatives = 1;
            recognition.continuous = false;
        }

        // ===== LIVE ÏãúÏûë =====
        var currentCameraMode = 'environment'; // Í∏∞Î≥∏: ÌõÑÎ©¥ Ïπ¥Î©îÎùº

        async function handleStart() {
            try {
                if (liveState.live) return;

                liveState.live = true;

                var btnStart = document.getElementById('btnStart');
                var btnStop = document.getElementById('btnStop');
                var btnHumanMic = document.getElementById('btnHumanMic');
                var btnAnimalMic = document.getElementById('btnAnimalMic');

                if (!btnStart || !btnStop || !btnHumanMic || !btnAnimalMic) {
                    console.error('‚ùå Î≤ÑÌäº ÏöîÏÜåÎ•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§');
                    showToast('‚ùå UI Î°úÎìú Ïò§Î•ò. ÌéòÏù¥ÏßÄÎ•º ÏÉàÎ°úÍ≥†Ïπ®ÌïòÏÑ∏Ïöî.', 'error');
                    liveState.live = false;
                    return;
                }

                btnStart.disabled = true;
                btnStop.disabled = false;
                btnHumanMic.disabled = false;
                btnAnimalMic.disabled = false;

                document.getElementById('statusBadge').className = 'status-badge live';
                document.getElementById('statusText').textContent = 'LIVE ÌôúÏÑ±';

                // Ïπ¥Î©îÎùº ÏºúÍ∏∞ + Í∞êÏ†ïÎ∂ÑÏÑù ÏãúÏûë
                const video = document.getElementById('liveVideo');
                try {
                    const stream = await openLiveCamera(video, currentCameraMode);
                    liveState.cameraStream = stream;

                    video.style.display = 'block';
                    document.getElementById('emotionBars').style.display = 'grid';
                    document.getElementById('cameraToggleButtons').style.display = 'flex';
                    updateCameraButtons();

                    startEmotionAnalysis();

                    addBubble('system', 'üêæ LIVE Î™®Îìú ÏãúÏûë! Ïπ¥Î©îÎùºÎ°ú Í∞êÏ†ï Î∂ÑÏÑù Ï§ë. ÎßàÏù¥ÌÅ¨ Î≤ÑÌäºÏúºÎ°ú ÏñëÎ∞©Ìñ• ÌÜµÏó≠ÌïòÏÑ∏Ïöî.');
                    showToast('üëÅÔ∏è AIÎàà ÌôúÏÑ±Ìôî + Í∞êÏ†ïÎ∂ÑÏÑù ÏãúÏûë!', 'success');
                } catch (err) {
                    if (err.message === "NEED_USER_GESTURE") {
                        showToast('‚ö†Ô∏è ÌôîÎ©¥ÏùÑ ÌÑ∞ÏπòÌïòÏó¨ Ïπ¥Î©îÎùºÎ•º ÏãúÏûëÌï¥Ï£ºÏÑ∏Ïöî.', 'warning');
                        video.onclick = () => { video.play(); video.onclick = null; };
                    } else {
                        throw err;
                    }
                }
            } catch (error) {
                console.error('‚ùå handleStart ÏóêÎü¨:', error);
                showToast('‚ùå ÏóêÎü¨ Î∞úÏÉù: ' + error.message, 'error');
                liveState.live = false;
            }
        }

        // ===== LIVE Ïπ¥Î©îÎùº ÏºúÍ∏∞ (Mobile Optimized) =====
        async function openLiveCamera(videoEl, prefer = "environment") {
            if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
                throw new Error("getUserMedia not supported");
            }

            // 1) mobile-friendly constraints (ideal + fallback)
            const tryConstraints = [
                { video: { facingMode: { ideal: prefer }, width: { ideal: 1280 }, height: { ideal: 720 } }, audio: false },
                { video: { facingMode: { ideal: "user" }, width: { ideal: 1280 }, height: { ideal: 720 } }, audio: false },
                { video: true, audio: false },
            ];

            let stream = null;
            let lastErr = null;

            for (const c of tryConstraints) {
                try {
                    stream = await navigator.mediaDevices.getUserMedia(c);
                    break;
                } catch (e) {
                    lastErr = e;
                }
            }
            if (!stream) throw lastErr || new Error("camera failed");

            // 2) assign stream
            videoEl.srcObject = stream;

            // 3) mobile autoplay policy ÎåÄÏùë
            videoEl.setAttribute("playsinline", "");
            videoEl.muted = true;
            videoEl.autoplay = true;

            try {
                await videoEl.play();
            } catch (e) {
                // Î™®Î∞îÏùºÏóêÏÑú ÎßâÌûàÎ©¥: "ÏãúÏûë" Î≤ÑÌäºÏùÑ ÎàåÎü¨ Îã§Ïãú play ÏãúÌÇ§Í≤å Ìï¥Ïïº Ìï®
                console.warn("video.play blocked:", e);
                // Ïó¨Í∏∞ÏÑú UIÎ°ú 'Ïπ¥Î©îÎùº ÏãúÏûë' Î≤ÑÌäº Î≥¥Ïó¨Ï£ºÍ≥†, Î≤ÑÌäº ÌÅ¥Î¶≠ Ïãú videoEl.play() Ìò∏Ï∂ú
                throw new Error("NEED_USER_GESTURE");
            }

            return stream;
        }

        // ===== Ïπ¥Î©îÎùº Ï†ÑÎ©¥/ÌõÑÎ©¥ Ï†ÑÌôò =====
        async function switchCameraMode(mode) {
            const video = document.getElementById('liveVideo');

            if (!liveState.live || !liveState.cameraStream) {
                showToast('‚ö†Ô∏è Ïπ¥Î©îÎùºÎ•º Î®ºÏ†Ä ÏºúÏ£ºÏÑ∏Ïöî.', 'warning');
                return;
            }

            try {
                if (liveState.cameraStream) {
                    liveState.cameraStream.getTracks().forEach(track => track.stop());
                }

                const video = document.getElementById('liveVideo');
                const stream = await openLiveCamera(video, mode);
                liveState.cameraStream = stream;

                currentCameraMode = mode;

                // Ï†ÑÎ©¥ Ïπ¥Î©îÎùºÎäî ÎØ∏Îü¨ÎßÅ
                if (mode === 'user') {
                    video.style.transform = 'scaleX(-1)';
                } else {
                    video.style.transform = 'scaleX(1)';
                }

                updateCameraButtons();
                showToast('‚úÖ Ïπ¥Î©îÎùº Ï†ÑÌôò ÏôÑÎ£å!', 'success');

            } catch (error) {
                console.error('Ïπ¥Î©îÎùº Ï†ÑÌôò Ïò§Î•ò:', error);
                showToast('‚ùå Ïπ¥Î©îÎùº Ï†ÑÌôò Ïã§Ìå®', 'error');
            }
        }

        // Ïπ¥Î©îÎùº Î≤ÑÌäº ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏
        function updateCameraButtons() {
            const btnFront = document.getElementById('btnCameraFront');
            const btnBack = document.getElementById('btnCameraBack');

            if (currentCameraMode === 'user') {
                if (btnFront) {
                    btnFront.style.background = 'rgba(45, 212, 191, 0.8)';
                    btnFront.style.color = 'white';
                }
                if (btnBack) {
                    btnBack.style.background = 'rgba(45, 212, 191, 0.3)';
                    btnBack.style.color = 'var(--primary-light)';
                }
            } else {
                if (btnFront) {
                    btnFront.style.background = 'rgba(45, 212, 191, 0.3)';
                    btnFront.style.color = 'var(--primary-light)';
                }
                if (btnBack) {
                    btnBack.style.background = 'rgba(45, 212, 191, 0.8)';
                    btnBack.style.color = 'white';
                }
            }
        }

        // ===== Í∞êÏ†ïÎ∂ÑÏÑù ÏãúÏûë =====
        function startEmotionAnalysis() {
            const emotionInterval = setInterval(() => {
                if (!liveState.live) {
                    clearInterval(emotionInterval);
                    return;
                }

                // 5Í∞ÄÏßÄ Í∞êÏ†ï ÎûúÎç§ ÏóÖÎç∞Ïù¥Ìä∏
                const emotions = [
                    { bar: 'emotionBar1', min: 20, max: 80 }, // Î∂àÏïà
                    { bar: 'emotionBar2', min: 10, max: 60 }, // Í≥†ÌÜµ
                    { bar: 'emotionBar3', min: 30, max: 90 }, // Ìù•Î∂Ñ
                    { bar: 'emotionBar4', min: 40, max: 100 }, // ÏïàÏ†ï
                    { bar: 'emotionBar5', min: 20, max: 70 }  // ÏöîÍµ¨
                ];

                emotions.forEach(e => {
                    const bar = document.getElementById(e.bar);
                    if (bar) {
                        const height = Math.random() * (e.max - e.min) + e.min;
                        bar.style.height = height + '%';
                    }
                });
            }, 800);

            liveState.emotionInterval = emotionInterval;
        }

        // ===== LIVE Ï§ëÏßÄ =====
        function handleStop() {
            liveState.live = false;
            liveState.isRecording = false;
            liveState.recognizing = false;
            liveState.speaking = false;

            // Ïπ¥Î©îÎùº Ï¢ÖÎ£å
            if (liveState.cameraStream) {
                liveState.cameraStream.getTracks().forEach(track => track.stop());
                liveState.cameraStream = null;
            }

            // Í∞êÏ†ïÎ∂ÑÏÑù Ï¢ÖÎ£å
            if (liveState.emotionInterval) {
                clearInterval(liveState.emotionInterval);
            }

            document.getElementById('liveVideo').style.display = 'none';
            document.getElementById('emotionBars').style.display = 'none';
            document.getElementById('cameraToggleButtons').style.display = 'none';

            if (recognition) {
                try { recognition.abort(); } catch (e) { }
            }

            if ('speechSynthesis' in window) {
                speechSynthesis.cancel();
            }

            var btnStart = document.getElementById('btnStart');
            var btnStop = document.getElementById('btnStop');
            var btnHumanMic = document.getElementById('btnHumanMic');
            var btnAnimalMic = document.getElementById('btnAnimalMic');

            btnStart.disabled = false;
            btnStop.disabled = true;
            btnHumanMic.disabled = true;
            btnAnimalMic.disabled = true;
            btnHumanMic.classList.remove('recording');
            btnAnimalMic.classList.remove('recording');

            document.getElementById('statusBadge').className = 'status-badge ready';
            document.getElementById('statusText').textContent = 'LIVE Ï§ÄÎπÑ';

            addBubble('system', '‚èπ LIVE Î™®Îìú Ï¢ÖÎ£å. Îã§Ïãú ÏãúÏûëÌïòÎ†§Î©¥ Î≤ÑÌäºÏùÑ ÎàåÎü¨Ï£ºÏÑ∏Ïöî.');
        }

        // ===== ÏÇ¨Îûå ‚Üí ÎèôÎ¨º ÌÜµÏó≠ =====
        async function handleHumanToAnimal() {
            if (!liveState.live || liveState.isRecording) return;

            liveState.isRecording = true;
            var btnHumanMic = document.getElementById('btnHumanMic');
            var btnAnimalMic = document.getElementById('btnAnimalMic');

            btnHumanMic.classList.add('recording');
            btnHumanMic.disabled = true;
            btnAnimalMic.disabled = true;

            document.getElementById('statusBadge').className = 'status-badge recording';
            document.getElementById('statusText').textContent = 'ÎÖπÏùå Ï§ë...';

            var recognizedText = null;

            if (recognition) {
                try {
                    recognizedText = await new Promise(function (resolve) {
                        var timeout = setTimeout(function () {
                            try { recognition.stop(); } catch (e) { }
                            resolve(null);
                        }, 3500);

                        recognition.onresult = function (e) {
                            clearTimeout(timeout);
                            var text = e.results[0][0].transcript;
                            resolve(text);
                        };

                        recognition.onerror = function () {
                            clearTimeout(timeout);
                            resolve(null);
                        };

                        recognition.start();
                    });
                } catch (err) {
                    console.warn('Recognition failed:', err);
                }
            }

            if (!recognizedText) {
                showToast('üé§ ÏùåÏÑ± Ïù∏Ïãù Ïã§Ìå®. ÌÖçÏä§Ìä∏Î°ú ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.', 'info');
                recognizedText = prompt('ÏùåÏÑ± Ïù∏Ïãù Ïã§Ìå®.\nÏßÅÏ†ë ÏûÖÎ†•ÌïòÏÑ∏Ïöî:', 'ÏïàÎÖï');
            }

            if (recognizedText) {
                addBubble('human', recognizedText);

                var animalResponse = translateToAnimal(recognizedText);

                setTimeout(function () {
                    var animal = ANIMALS[selectedAnimal];
                    addBubbleWithPlay('animal', animal.icon + ' ' + animal.name + ': ' + animalResponse, animalResponse);
                    speakText(animalResponse, animal.pitch);
                    updateLearning();
                }, 500);
            }

            liveState.isRecording = false;
            btnHumanMic.classList.remove('recording');
            btnHumanMic.disabled = false;
            btnAnimalMic.disabled = false;

            document.getElementById('statusBadge').className = 'status-badge live';
            document.getElementById('statusText').textContent = 'LIVE ÌôúÏÑ±';
        }

        // ===== ÎèôÎ¨º ‚Üí ÏÇ¨Îûå ÌÜµÏó≠ =====
        async function handleAnimalToHuman() {
            if (!liveState.live || liveState.isRecording) return;

            liveState.isRecording = true;
            var btnHumanMic = document.getElementById('btnHumanMic');
            var btnAnimalMic = document.getElementById('btnAnimalMic');

            btnAnimalMic.classList.add('recording');
            btnHumanMic.disabled = true;
            btnAnimalMic.disabled = true;

            var animal = ANIMALS[selectedAnimal];

            document.getElementById('statusBadge').className = 'status-badge recording';
            document.getElementById('statusText').textContent = 'ÎÖπÏùå Ï§ë...';

            // 3Ï¥à ÎåÄÍ∏∞
            await new Promise(function (r) { setTimeout(r, 3000); });

            var sounds = animal.sounds;
            var animalSound = sounds[Math.floor(Math.random() * sounds.length)];

            addBubble('animal', animal.icon + ' ' + animal.name + ': ' + animalSound);

            var emotions = ['happy', 'hungry', 'anxious', 'alert', 'love'];
            var emotion = emotions[Math.floor(Math.random() * emotions.length)];

            var translations = ANIMAL_TO_HUMAN[selectedAnimal][emotion];
            var humanTranslation = translations[Math.floor(Math.random() * translations.length)];

            setTimeout(function () {
                addBubbleWithPlay('translation', 'üó£Ô∏è ÌÜµÏó≠: "' + humanTranslation + '"', humanTranslation);
                speakText(humanTranslation, 1.0);
                updateLearning();
            }, 600);

            liveState.isRecording = false;
            btnAnimalMic.classList.remove('recording');
            btnHumanMic.disabled = false;
            btnAnimalMic.disabled = false;

            document.getElementById('statusBadge').className = 'status-badge live';
            document.getElementById('statusText').textContent = 'LIVE ÌôúÏÑ±';
        }

        // ===== ÌÜµÏó≠ Ìï®Ïàò =====
        function translateToAnimal(text) {
            for (var keyword in HUMAN_KEYWORDS) {
                if (text.includes(keyword)) {
                    return HUMAN_KEYWORDS[keyword].responses[selectedAnimal];
                }
            }

            var defaultResponses = {
                dog: 'Î©ç! Íº¨Î¶¨ ÌùîÎì§~ (ÏïåÍ≤†Ïñ¥Ïöî!)',
                cat: 'ÎÉêÏòπ~ (ÏïåÏïòÎã§ ÎÉ•)',
                chick: 'ÏÇêÏïΩ! (ÎÑ§!)'
            };

            return defaultResponses[selectedAnimal];
        }

        // ===== TTS ÏùåÏÑ± Ï∂úÎ†• =====
        function speakText(text, basePitch) {
            if (!('speechSynthesis' in window)) {
                console.warn('TTS not supported');
                return;
            }

            speechSynthesis.cancel();

            var utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = 'ko-KR';
            utterance.rate = parseFloat(document.getElementById('speechRate').value) || 1;
            utterance.pitch = (parseFloat(document.getElementById('speechPitch').value) || 1) * basePitch;
            utterance.volume = parseFloat(document.getElementById('speechVolume').value) || 1;

            utterance.onstart = function () {
                liveState.speaking = true;
            };

            utterance.onend = function () {
                liveState.speaking = false;
            };

            speechSynthesis.speak(utterance);
        }

        // ===== ÎèôÎ¨º ÏÑ†ÌÉù =====
        function selectAnimal(btn) {
            document.querySelectorAll('.animal-btn').forEach(function (b) {
                b.classList.remove('selected');
            });
            btn.classList.add('selected');
            selectedAnimal = btn.dataset.animal;

            var animal = ANIMALS[selectedAnimal];
            document.getElementById('animalIcon').textContent = animal.icon;
            document.getElementById('animalLabel').textContent = animal.name;

            showToast(animal.icon + ' ' + animal.name + ' ÏÑ†ÌÉù!', 'success');
        }

        // ===== Ï±ÑÌåÖ Î≤ÑÎ∏î =====
        function addBubble(type, content) {
            var div = document.createElement('div');
            div.className = 'bubble ' + type;

            var header = '';
            if (type === 'human') header = '<div class="bubble-header">üë§ Î≥¥Ìò∏Ïûê</div>';
            else if (type === 'animal') header = '<div class="bubble-header">üêæ ÎèôÎ¨º</div>';
            else if (type === 'translation') header = '<div class="bubble-header">üó£Ô∏è ÌÜµÏó≠ Í≤∞Í≥º</div>';

            div.innerHTML = header + '<div class="bubble-content">' + escapeHtml(content) + '</div>';

            var chatContainer = document.getElementById('chatContainer');
            chatContainer.appendChild(div);
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        function addBubbleWithPlay(type, content, textToPlay) {
            var div = document.createElement('div');
            div.className = 'bubble ' + type;

            var header = '';
            if (type === 'human') header = '<div class="bubble-header">üë§ Î≥¥Ìò∏Ïûê</div>';
            else if (type === 'animal') header = '<div class="bubble-header">üêæ ÎèôÎ¨º</div>';
            else if (type === 'translation') header = '<div class="bubble-header">üó£Ô∏è ÌÜµÏó≠ Í≤∞Í≥º</div>';

            div.innerHTML = header +
                '<div class="bubble-content">' + escapeHtml(content) + '</div>' +
                '<button class="play-btn" onclick="playSound(\'' + escapeHtml(textToPlay).replace(/'/g, "\\'") + '\')">üîä Îã§Ïãú Ïû¨ÏÉù</button>';

            var chatContainer = document.getElementById('chatContainer');
            chatContainer.appendChild(div);
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        function escapeHtml(text) {
            var div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function playSound(text) {
            var animal = ANIMALS[selectedAnimal];
            speakText(text, animal.pitch);
        }

        // ===== ÌïôÏäµ ÏóÖÎç∞Ïù¥Ìä∏ =====
        function updateLearning() {
            learningData.count++;
            learningData.accuracy = Math.min(95, 12.5 + (learningData.count * 0.8));
            localStorage.setItem('petctt_learning', JSON.stringify(learningData));
            updateLearningUI();
        }

        function updateLearningUI() {
            document.getElementById('learningPercent').textContent = learningData.accuracy.toFixed(1) + '%';
            document.getElementById('learningProgress').style.width = learningData.accuracy + '%';
        }

        // ÌÜ†Ïä§Ìä∏ Ìï®Ïàò
        function showToast(message, type) {
            var toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = 'toast show ' + (type || 'info');
            setTimeout(() => {
                toast.className = 'toast';
            }, 3000);
        }

        // ÏÑ§Ï†ï Ìï®ÏàòÎì§
        function openSettings() {
            document.getElementById('settingsModal').classList.add('show');
        }

        function closeSettings() {
            document.getElementById('settingsModal').classList.remove('show');
        }

        function updateRateValue() {
            document.getElementById('rateValue').textContent = document.getElementById('speechRate').value + 'x';
        }

        function updatePitchValue() {
            document.getElementById('pitchValue').textContent = document.getElementById('speechPitch').value;
        }

        function updateVolumeValue() {
            document.getElementById('volumeValue').textContent = Math.round(document.getElementById('speechVolume').value * 100) + '%';
        }

        // ===== Î∞©ÏÜ°Íµ≠ Ìï®Ïàò =====
        var broadcastState = {
            selectedCategory: null,
            categories: {
                medical: { title: 'üè• ÏùòÌïôÏÉÅÎã¥', desc: 'Î∞òÎ†§ÎèôÎ¨º Í±¥Í∞ï Í¥ÄÎ†® Ï†ÑÎ¨∏Í∞Ä ÏÉÅÎã¥ Î∞©ÏÜ°' },
                news: { title: 'üì∞ Îâ¥Ïä§', desc: 'Î∞òÎ†§ÎèôÎ¨º Í¥ÄÎ†® ÏµúÏã† Îâ¥Ïä§' },
                audition: { title: 'üé§ Ïò§ÎîîÏÖò', desc: 'Î∞òÎ†§ÎèôÎ¨º Ïû¨Îä• Í≥µÍ∞ú Î∞©ÏÜ°' },
                exploration: { title: 'üîç ÌÉêÏÇ¨', desc: 'Î∞òÎ†§ÎèôÎ¨º ÏäµÏÑ± ÌÉêÏÇ¨ ÌîÑÎ°úÍ∑∏Îû®' },
                shopping: { title: 'üõçÔ∏è ÏáºÌïë', desc: 'Î∞òÎ†§ÎèôÎ¨º Ïö©Ìíà ÏáºÌïë Ï±ÑÎÑê' },
                global: { title: 'üåç Í∏ÄÎ°úÎ≤å', desc: 'ÏÑ∏Í≥ÑÏùò Î∞òÎ†§ÎèôÎ¨º Î¨∏Ìôî ÍµêÎ•ò' }
            }
        };

        function openBroadcastStation() {
            document.getElementById('broadcastModal').classList.add('show');
        }

        function closeBroadcastStation() {
            document.getElementById('broadcastModal').classList.remove('show');
            broadcastState.selectedCategory = null;
            document.getElementById('broadcastInfo').style.display = 'none';
            document.querySelectorAll('.broadcast-category-btn').forEach(btn => {
                btn.style.opacity = '0.6';
            });
        }

        function selectBroadcastCategory(category) {
            broadcastState.selectedCategory = category;

            // Î≤ÑÌäº ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏
            document.querySelectorAll('.broadcast-category-btn').forEach(btn => {
                if (btn.getAttribute('data-category') === category) {
                    btn.style.opacity = '1';
                    btn.style.boxShadow = '0 0 16px ' + btn.style.color;
                } else {
                    btn.style.opacity = '0.6';
                    btn.style.boxShadow = 'none';
                }
            });

            // Ïπ¥ÌÖåÍ≥†Î¶¨ Ï†ïÎ≥¥ ÌëúÏãú
            var catInfo = broadcastState.categories[category];
            document.getElementById('selectedCategoryTitle').textContent = catInfo.title;
            document.getElementById('selectedCategoryDesc').textContent = catInfo.desc;
            document.getElementById('broadcastInfo').style.display = 'block';

            showToast(catInfo.title + ' ÏÑ†ÌÉùÎê® ‚ú®', 'success');
        }

        function startBroadcast() {
            if (!broadcastState.selectedCategory) {
                showToast('Î∞©ÏÜ° Ï±ÑÎÑêÏùÑ Î®ºÏ†Ä ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî', 'warning');
                return;
            }

            var catInfo = broadcastState.categories[broadcastState.selectedCategory];
            closeBroadcastStation();

            showToast('üé¨ ' + catInfo.title + ' Î∞©ÏÜ° ÏãúÏûë! (Îç∞Î™®)', 'success');

            // ÏãúÎÆ¨Î†àÏù¥ÏÖò
            setTimeout(() => {
                addBubble('system', 'üì° ' + catInfo.title + ' ÎùºÏù¥Î∏å Î∞©ÏÜ°Ïù¥ ÏãúÏûëÎêòÏóàÏäµÎãàÎã§!\n\nÌòÑÏû¨ ÎùºÏù¥Î∏å Í∏∞Îä•ÏùÄ Îç∞Î™® Î≤ÑÏ†ÑÏûÖÎãàÎã§.\nÏ†ïÏãù Î≤ÑÏ†ÑÏóêÏÑúÎäî Ïã§Ï†ú Î∞©ÏÜ°Ïù¥ ÏÜ°Ï∂úÎê©ÎãàÎã§.');
            }, 300);
        }

        // ===== Í±¥Í∞ïÏ≤¥ÌÅ¨ Ìï®Ïàò =====
        var healthCheckState = {
            running: false,
            audioContext: null,
            analyser: null,
            dataArray: null,
            recordingData: [],
            timeRemaining: 30,
            bioScanning: false,
            bioStream: null,
            bioCurrentCamera: 'environment',
            bioMetricsInterval: null
        };

        // ÌéÑÏä§ ÏÑºÏÑú Î™®Îìú ÏãúÏûë
        function startPulseCheck() {
            document.getElementById('pulseMode').style.display = 'block';
            document.getElementById('bioScanMode').style.display = 'none';
            document.getElementById('btnPulseMode').style.background = 'rgba(45, 212, 191, 0.8)';
            document.getElementById('btnPulseMode').style.color = 'white';
            document.getElementById('btnBioMode').style.background = 'rgba(45, 212, 191, 0.2)';
            document.getElementById('btnBioMode').style.color = 'var(--primary-light)';

            handleHealthStart();
        }

        // ÏÉùÏ≤¥Ïä§Ï∫î Î™®Îìú ÏãúÏûë
        function startBioScan() {
            document.getElementById('bioScanMode').style.display = 'block';
            document.getElementById('pulseMode').style.display = 'none';
            document.getElementById('btnBioMode').style.background = 'rgba(45, 212, 191, 0.8)';
            document.getElementById('btnBioMode').style.color = 'white';
            document.getElementById('btnPulseMode').style.background = 'rgba(45, 212, 191, 0.2)';
            document.getElementById('btnPulseMode').style.color = 'var(--primary-light)';
        }

        // ÏÉùÏ≤¥Ïä§Ï∫î Î∂ÑÏÑù ÏãúÏûë
        async function startBioScanAnalysis() {
            if (healthCheckState.bioScanning) return;

            healthCheckState.bioScanning = true;
            document.getElementById('btnStartBio').style.display = 'none';
            document.getElementById('btnStopBio').style.display = 'block';
            document.getElementById('bioResults').style.display = 'none';
            document.getElementById('aiAnalysisResult').style.display = 'none';
            document.getElementById('googleSearchResult').style.display = 'none';

            const video = document.getElementById('bioVideo');
            healthCheckState.bioCurrentCamera = 'environment';

            try {
                const stream = await openLiveCamera(video, 'environment');

                healthCheckState.bioStream = stream;
                video.style.display = 'block';

                // Î≤ÑÌäº ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏
                document.getElementById('bioCameraFront').style.background = 'rgba(45, 212, 191, 0.3)';
                document.getElementById('bioCameraFront').style.color = 'var(--primary-light)';
                document.getElementById('bioCameraBack').style.background = 'rgba(45, 212, 191, 0.8)';
                document.getElementById('bioCameraBack').style.color = 'white';

                showToast('üì∏ Ïπ¥Î©îÎùºÎ°ú AI Í≤ÄÏßÑ ÏãúÏûë! Í∞ïÏïÑÏßÄÎ•º ÌôîÎ©¥Ïóê ÎßûÏ∂∞Ï£ºÏÑ∏Ïöî.', 'success');

                // 3Ï¥à ÌõÑ Î∂ÑÏÑù ÏãúÏûë
                setTimeout(() => {
                    if (healthCheckState.bioScanning) {
                        startBioMetricsAnalysis();
                        startAIAnalysis();
                    }
                }, 3000);

            } catch (error) {
                console.error('Ïπ¥Î©îÎùº Ï†ëÍ∑º Ïò§Î•ò:', error);
                showToast('üì∑ Ïπ¥Î©îÎùº Í∂åÌïúÏù¥ ÌïÑÏöîÌï©ÎãàÎã§.', 'error');
                stopBioScanAnalysis();
            }
        }

        // ÏÉùÏ≤¥ ÏßÄÌëú Ïã§ÏãúÍ∞Ñ Î∂ÑÏÑù
        function startBioMetricsAnalysis() {
            const interval = setInterval(() => {
                if (!healthCheckState.bioScanning) {
                    clearInterval(interval);
                    return;
                }

                // Ïã¨Î∞ïÏàò: 70~85 Î≤îÏúÑ
                const pulse = Math.floor(Math.random() * 15 + 70);
                document.getElementById('pulseResult').textContent = pulse;

                // Ìò∏Ìù°: 28~35 Î≤îÏúÑ
                const respiration = Math.floor(Math.random() * 8 + 28);
                document.getElementById('respirationResult').textContent = respiration;

                // Ï≤¥Ïò®: 37.8~38.2 Î≤îÏúÑ
                const temperature = (Math.random() * 0.4 + 37.8).toFixed(1);
                document.getElementById('temperatureResult').textContent = temperature;

                // Ïä§Ìä∏Î†àÏä§: 50~80 Î≤îÏúÑ
                const stress = Math.floor(Math.random() * 30 + 50);
                document.getElementById('stressResult').textContent = stress;
            }, 1500);

            healthCheckState.bioMetricsInterval = interval;
        }

        // AI Í≤ÄÏßÑ Î∂ÑÏÑù ÏãúÏûë
        function startAIAnalysis() {
            const analysisTexts = [
                'ü§ñ AI Î∂ÑÏÑù: Ïã†Ï≤¥ ÏÉÅÌÉúÍ∞Ä ÏñëÌò∏Ìï©ÎãàÎã§. ÌîºÎ∂Ä ÏÉÅÌÉúÍ∞Ä Í±¥Í∞ïÌïòÍ≥† ÎààÎèôÏûêÍ∞Ä ÎßëÏäµÎãàÎã§.',
                'ü§ñ AI Î∂ÑÏÑù: Í∑Ä ÏÉÅÌÉúÍ∞Ä Íπ®ÎÅóÌïòÍ≥† ÏóºÏ¶ùÏù¥ ÏóÜÏñ¥ Î≥¥ÏûÖÎãàÎã§. Ï†ÑÎ∞òÏ†ÅÏúºÎ°ú Í±¥Í∞ïÌïú ÏÉÅÌÉúÏûÖÎãàÎã§.',
                'ü§ñ AI Î∂ÑÏÑù: Ï≤¥ÌòïÏù¥ Ïù¥ÏÉÅÏ†ÅÏù¥Í≥† ÌîºÎ™®Ïùò Ïú§Í∏∞Í∞Ä Ï¢ãÏäµÎãàÎã§. ÏòÅÏñë ÏÉÅÌÉúÍ∞Ä Ï¢ãÏäµÎãàÎã§.',
                'ü§ñ AI Î∂ÑÏÑù: ÏñºÍµ¥ ÌëúÏ†ïÏù¥ Î∞ùÍ≥† ÌôúÍ∏∞Í∞Ä ÏûàÏäµÎãàÎã§. Ïä§Ìä∏Î†àÏä§ ÏàòÏ§ÄÏù¥ ÎÇÆÏäµÎãàÎã§.',
                'ü§ñ AI Î∂ÑÏÑù: Ïã†Ï≤¥ ÏõÄÏßÅÏûÑÏù¥ ÏûêÏó∞Ïä§ÎüΩÍ≥† ÎØºÏ≤©Ìï©ÎãàÎã§. Í¥ÄÏ†à ÏÉÅÌÉúÍ∞Ä ÏñëÌò∏Ìï¥ Î≥¥ÏûÖÎãàÎã§.'
            ];

            setTimeout(() => {
                if (healthCheckState.bioScanning) {
                    const randomAnalysis = analysisTexts[Math.floor(Math.random() * analysisTexts.length)];
                    document.getElementById('aiAnalysisContent').textContent = randomAnalysis;
                    document.getElementById('aiAnalysisResult').style.display = 'block';

                    // Google Í≤ÄÏÉâ Í≤∞Í≥ºÎèÑ Ìï®Íªò ÌëúÏãú
                    setTimeout(() => {
                        if (healthCheckState.bioScanning) {
                            performGoogleSearch();
                        }
                    }, 2000);
                }
            }, 5000);
        }

        // Google Í≤ÄÏÉâ Ï†ïÎ≥¥ (ÏãúÎÆ¨Î†àÏù¥ÏÖò)
        function performGoogleSearch() {
            const searchResults = [
                {
                    title: 'Í∞ïÏïÑÏßÄ Í±¥Í∞ï Ï≤¥ÌÅ¨ Î∞©Î≤ï',
                    summary: 'Ï†ïÏÉÅÏ†ÅÏù∏ Í∞ïÏïÑÏßÄÏùò Ïã¨Î∞ïÏàòÎäî Î∂ÑÎãπ 60~100Ìöå, Ìò∏Ìù°ÏàòÎäî Î∂ÑÎãπ 10~30Ìöå, Ï≤¥Ïò®ÏùÄ 38~39‚ÑÉÏûÖÎãàÎã§. Ï†ïÍ∏∞Ï†ÅÏù∏ Í±¥Í∞ï Í≤ÄÏßÑÍ≥º ÏòàÎ∞©Ï†ëÏ¢ÖÏù¥ Ï§ëÏöîÌï©ÎãàÎã§.',
                    link: 'https://www.google.com/search?q=Í∞ïÏïÑÏßÄ+Í±¥Í∞ï+Ï≤¥ÌÅ¨'
                },
                {
                    title: 'Î∞òÎ†§ÎèôÎ¨º Ïä§Ìä∏Î†àÏä§ Í¥ÄÎ¶¨',
                    summary: 'Í∞ïÏïÑÏßÄÏùò Ïä§Ìä∏Î†àÏä§Î•º Ï§ÑÏù¥Í∏∞ ÏúÑÌï¥ Í∑úÏπôÏ†ÅÏù∏ ÏÇ∞Ï±Ö, ÎÜÄÏù¥ ÏãúÍ∞Ñ, Í∑∏Î¶¨Í≥† Ìé∏ÏïàÌïú ÌôòÍ≤ΩÏù¥ ÌïÑÏöîÌï©ÎãàÎã§. Ïä§Ìä∏Î†àÏä§Í∞Ä ÎÜíÏúºÎ©¥ ÌñâÎèô Î¨∏Ï†úÎ°ú Ïù¥Ïñ¥Ïßà Ïàò ÏûàÏäµÎãàÎã§.',
                    link: 'https://www.google.com/search?q=Í∞ïÏïÑÏßÄ+Ïä§Ìä∏Î†àÏä§+Í¥ÄÎ¶¨'
                },
                {
                    title: 'Í∞ïÏïÑÏßÄ ÌîºÎ™® Í±¥Í∞ï',
                    summary: 'Í±¥Í∞ïÌïú ÌîºÎ™®Îäî ÏòÅÏñë ÏÑ≠Ï∑®Í∞Ä Ï∂©Î∂ÑÌï®ÏùÑ ÎÇòÌÉÄÎÉÖÎãàÎã§. Ïò§Î©îÍ∞Ä-3ÏôÄ Ïò§Î©îÍ∞Ä-6 ÏßÄÎ∞©ÏÇ∞Ïù¥ ÌíçÎ∂ÄÌïú ÏùåÏãùÏù¥ ÎèÑÏõÄÎê©ÎãàÎã§. Ï†ïÍ∏∞Ï†ÅÏù∏ Î™©ÏöïÍ≥º ÎπóÏßàÏù¥ ÌïÑÏöîÌï©ÎãàÎã§.',
                    link: 'https://www.google.com/search?q=Í∞ïÏïÑÏßÄ+ÌîºÎ™®+Í±¥Í∞ï'
                }
            ];

            const randomResult = searchResults[Math.floor(Math.random() * searchResults.length)];

            document.getElementById('googleSearchContent').innerHTML = `
            <div style="margin-bottom: 8px;"><strong>${randomResult.title}</strong></div>
            <div>${randomResult.summary}</div>
        `;
            document.getElementById('googleSearchLink').href = randomResult.link;
            document.getElementById('googleSearchResult').style.display = 'block';

            showToast('üîç Í±¥Í∞ï Ï†ïÎ≥¥ Í≤ÄÏÉâ ÏôÑÎ£å!', 'success');
        }

        // Ïπ¥Î©îÎùº Ï†Ñ/ÌõÑ Ï†ÑÌôò
        async function switchBioCamera(mode) {
            if (!healthCheckState.bioScanning) {
                showToast('‚ö†Ô∏è Î®ºÏ†Ä ÏãúÏûë Î≤ÑÌäºÏùÑ ÎàåÎü¨Ï£ºÏÑ∏Ïöî', 'warning');
                return;
            }

            try {
                if (healthCheckState.bioStream) {
                    healthCheckState.bioStream.getTracks().forEach(track => track.stop());
                }

                const video = document.getElementById('bioVideo');
                const stream = await openLiveCamera(video, mode);

                healthCheckState.bioCurrentCamera = mode;
                healthCheckState.bioStream = stream;

                // Ï†ÑÎ©¥ Ïπ¥Î©îÎùºÎäî ÎØ∏Îü¨ÎßÅ
                if (mode === 'user') {
                    video.style.transform = 'scaleX(-1)';
                } else {
                    video.style.transform = 'scaleX(1)';
                }

                // Î≤ÑÌäº ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏
                if (mode === 'user') {
                    document.getElementById('bioCameraFront').style.background = 'rgba(45, 212, 191, 0.8)';
                    document.getElementById('bioCameraFront').style.color = 'white';
                    document.getElementById('bioCameraBack').style.background = 'rgba(45, 212, 191, 0.3)';
                    document.getElementById('bioCameraBack').style.color = 'var(--primary-light)';
                } else {
                    document.getElementById('bioCameraFront').style.background = 'rgba(45, 212, 191, 0.3)';
                    document.getElementById('bioCameraFront').style.color = 'var(--primary-light)';
                    document.getElementById('bioCameraBack').style.background = 'rgba(45, 212, 191, 0.8)';
                    document.getElementById('bioCameraBack').style.color = 'white';
                }

                showToast('‚úÖ Ïπ¥Î©îÎùº Ï†ÑÌôò ÏôÑÎ£å!', 'success');

            } catch (error) {
                console.error('Ïπ¥Î©îÎùº Ï†ÑÌôò Ïò§Î•ò:', error);
                showToast('‚ùå Ïπ¥Î©îÎùº Ï†ÑÌôò Ïã§Ìå®', 'error');
            }
        }

        // Î∂ÑÏÑù Í≤∞Í≥º Ï†ÄÏû•
        function saveBioAnalysisResults() {
            const results = {
                timestamp: new Date().toLocaleString('ko-KR'),
                pulse: document.getElementById('pulseResult').textContent,
                respiration: document.getElementById('respirationResult').textContent,
                temperature: document.getElementById('temperatureResult').textContent,
                stress: document.getElementById('stressResult').textContent,
                aiAnalysis: document.getElementById('aiAnalysisContent').textContent,
                googleInfo: document.getElementById('googleSearchContent').innerHTML
            };

            let savedResults = JSON.parse(localStorage.getItem('bioAnalysisResults') || '[]');
            savedResults.unshift(results);
            if (savedResults.length > 20) savedResults.pop();
            localStorage.setItem('bioAnalysisResults', JSON.stringify(savedResults));

            showToast('üíæ Î∂ÑÏÑù Í≤∞Í≥ºÍ∞Ä Ï†ÄÏû•ÎêòÏóàÏäµÎãàÎã§!', 'success');
        }

        // ÏÉùÏ≤¥Ïä§Ï∫î ÏôÑÎ£å
        function completeBioScan() {
            healthCheckState.bioScanning = false;

            if (healthCheckState.bioStream) {
                healthCheckState.bioStream.getTracks().forEach(track => track.stop());
                healthCheckState.bioStream = null;
            }

            document.getElementById('btnStartBio').style.display = 'block';
            document.getElementById('btnStopBio').style.display = 'none';
            document.getElementById('bioResults').style.display = 'block';

            showToast('‚úÖ ÏÉùÏ≤¥Ïä§Ï∫î ÏôÑÎ£å! Í≤∞Í≥ºÎ•º ÌôïÏù∏ÌïòÏÑ∏Ïöî.', 'success');
        }

        // ÏÉùÏ≤¥Ïä§Ï∫î Ï§ëÏßÄ
        function stopBioScanAnalysis() {
            healthCheckState.bioScanning = false;

            if (healthCheckState.bioStream) {
                healthCheckState.bioStream.getTracks().forEach(track => track.stop());
                healthCheckState.bioStream = null;
            }

            if (healthCheckState.bioMetricsInterval) {
                clearInterval(healthCheckState.bioMetricsInterval);
                healthCheckState.bioMetricsInterval = null;
            }

            const video = document.getElementById('bioVideo');
            video.style.display = 'none';
            video.srcObject = null;

            document.getElementById('btnStartBio').style.display = 'block';
            document.getElementById('btnStopBio').style.display = 'none';
            document.getElementById('bioResults').style.display = 'block';

            showToast('‚úÖ AI Í≤ÄÏßÑ Ï¢ÖÎ£å! Í≤∞Í≥ºÎ•º Ï†ÄÏû•ÌïòÏÑ∏Ïöî.', 'success');
        }

        // Í∏∞Ï°¥ ÌéÑÏä§ÏÑºÏÑú Ìï®ÏàòÎì§
        function handleHealthStart() {
            if (healthCheckState.running) return;
            healthCheckState.running = true;
            healthCheckState.recordingData = [];
            healthCheckState.timeRemaining = 30;

            document.getElementById('healthState').textContent = 'Ï∏°Ï†ï Ï§ë...';
            document.getElementById('healthResults').style.display = 'none';
            document.getElementById('recordsList').style.display = 'none';

            initAudioForHealthCheck();
            startHealthCheckTimer();
            showToast('üé§ ÌéÑÏä§ÏÑºÏÑú Ï∏°Ï†ï ÏãúÏûë! 30Ï¥à ÎèôÏïà Î∂ÑÏÑù Ï§ë...', 'success');
        }

        function handleHealthStop() {
            healthCheckState.running = false;
            if (healthCheckState.audioContext && healthCheckState.audioContext.state !== 'closed') {
                healthCheckState.audioContext.close();
            }
            healthCheckState.audioContext = null;
            healthCheckState.analyser = null;

            document.getElementById('healthState').textContent = 'Ï§ëÎã®Îê®';
        }

        function initAudioForHealthCheck() {
            try {
                if (!healthCheckState.audioContext) {
                    healthCheckState.audioContext = new (window.AudioContext || window.webkitAudioContext)();
                }
                var ctx = healthCheckState.audioContext;

                navigator.mediaDevices.getUserMedia({ audio: true })
                    .then(stream => {
                        var source = ctx.createMediaStreamSource(stream);
                        var analyser = ctx.createAnalyser();
                        analyser.fftSize = 256;
                        source.connect(analyser);

                        healthCheckState.analyser = analyser;
                        healthCheckState.dataArray = new Uint8Array(analyser.frequencyBinCount);

                        analyzeHealthAudio();
                    })
                    .catch(err => {
                        console.warn('Microphone access denied', err);
                        showToast('ÎßàÏù¥ÌÅ¨ Ï†ëÍ∑º Í±∞Î∂ÄÎê®', 'error');
                        handleHealthStop();
                    });
            } catch (err) {
                console.error('Audio context error:', err);
                showToast('Ïò§ÎîîÏò§ Ï¥àÍ∏∞Ìôî Ïã§Ìå®', 'error');
                handleHealthStop();
            }
        }

        function analyzeHealthAudio() {
            if (!healthCheckState.running || !healthCheckState.analyser) return;

            healthCheckState.analyser.getByteFrequencyData(healthCheckState.dataArray);

            var average = 0;
            for (var i = 0; i < healthCheckState.dataArray.length; i++) {
                average += healthCheckState.dataArray[i];
            }
            average = average / healthCheckState.dataArray.length;
            var normalized = Math.min(100, (average / 255) * 120);

            healthCheckState.recordingData.push(normalized);
            document.getElementById('healthMeterFill').style.width = normalized + '%';
            document.getElementById('healthAvg').textContent = (normalized / 100).toFixed(3);

            requestAnimationFrame(analyzeHealthAudio);
        }

        function startHealthCheckTimer() {
            var interval = setInterval(() => {
                if (!healthCheckState.running) {
                    clearInterval(interval);
                    return;
                }

                healthCheckState.timeRemaining--;
                document.getElementById('healthTime').textContent = healthCheckState.timeRemaining + 's';

                if (healthCheckState.timeRemaining <= 0) {
                    clearInterval(interval);
                    completeHealthCheck();
                }
            }, 1000);
        }

        function completeHealthCheck() {
            handleHealthStop();

            var avgLevel = healthCheckState.recordingData.reduce((a, b) => a + b, 0) / healthCheckState.recordingData.length;
            var now = new Date();
            var record = {
                date: now.toLocaleDateString('ko-KR'),
                time: now.toLocaleTimeString('ko-KR'),
                level: avgLevel.toFixed(2),
                evaluation: getHealthEvaluation(avgLevel)
            };

            var records = JSON.parse(localStorage.getItem('petctt_health_records') || '[]');
            records.unshift(record);
            if (records.length > 10) records.pop();
            localStorage.setItem('petctt_health_records', JSON.stringify(records));

            displayHealthResults(record);
            showToast('‚úÖ ÌéÑÏä§ÏÑºÏÑú Ï∏°Ï†ï ÏôÑÎ£å!', 'success');
        }

        function getHealthEvaluation(level) {
            if (level < 20) return 'Ï°∞Ïö©Ìï® - Ï∂©Î∂ÑÌïú ÌôúÎèôÏÑ±ÏùÑ Î≥¥ÏûÖÎãàÎã§';
            if (level < 40) return 'Ï†ïÏÉÅ - Ï¢ãÏùÄ ÏÉÅÌÉúÏûÖÎãàÎã§';
            if (level < 60) return 'ÌôúÎ∞úÌï® - ÏóêÎÑàÏßÄÍ∞Ä ÎßéÏäµÎãàÎã§';
            if (level < 80) return 'Îß§Ïö∞ ÌôúÎ∞úÌï® - Ïö¥ÎèôÏùÑ ÎßéÏù¥ Ìï©ÎãàÎã§';
            return 'Í≥ºÎèÑÌï® - Í≥ºÎèÑÌïú ÏõÄÏßÅÏûÑÏùÑ Î≥¥ÏûÖÎãàÎã§';
        }

        function displayHealthResults(record) {
            document.getElementById('healthState').textContent = 'ÏôÑÎ£å';
            document.getElementById('healthComment').textContent = record.evaluation;
            document.getElementById('healthDetails').innerHTML =
                '<div>' + record.date + ' ' + record.time + '</div>' +
                '<div>ÌèâÍ∑† ÌôúÎèôÎèÑ: ' + record.level + '%</div>';
            document.getElementById('healthResults').style.display = 'block';
        }

        function viewHealthRecords() {
            var records = JSON.parse(localStorage.getItem('petctt_health_records') || '[]');
            var html = '';

            if (records.length === 0) {
                html = '<div style="color: var(--text-muted); text-align: center; padding: 20px;">Í±¥Í∞ï Í∏∞Î°ùÏù¥ ÏóÜÏäµÎãàÎã§.</div>';
            } else {
                html = records.map((record, idx) => `
                <div style="background: rgba(0, 0, 0, 0.2); border-radius: 8px; padding: 12px; margin-bottom: 8px; border-left: 3px solid #10b981;">
                    <div style="font-size: 0.8rem; color: var(--text-muted);">${record.date} ${record.time}</div>
                    <div style="font-size: 0.9rem; color: var(--text);">${record.evaluation}</div>
                    <div style="font-size: 0.75rem; color: var(--primary-light); margin-top: 4px;">Î†àÎ≤®: ${record.level}%</div>
                </div>
            `).join('');
            }

            document.getElementById('recordsContainer').innerHTML = html;
            document.getElementById('recordsList').style.display = document.getElementById('recordsList').style.display === 'none' ? 'block' : 'none';
        }

        // ÌÉ≠ Ï†ÑÌôò Ìï®Ïàò
        function switchTab(tabName) {
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.tab === tabName);
            });
            document.querySelectorAll('.section').forEach(section => {
                section.classList.toggle('active', section.id === tabName);
            });

            if (tabName === 'locate' && locationData.map) {
                setTimeout(() => locationData.map.invalidateSize(), 100);
            }
        }
    </script>
    <!-- Three.js Canvas Container -->
    <div id="canvas-container"></div>

    <script>
        // Three.js Background Animation (from AIRCTT)
        let scene, camera, renderer, particles;
        let mouseX = 0, mouseY = 0;

        function initThree() {
            const container = document.getElementById('canvas-container');
            if (!container) return;

            scene = new THREE.Scene();
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.z = 5;

            renderer = new THREE.WebGLRenderer({ alpha: true, antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            container.appendChild(renderer.domElement);

            // Create particle system
            const geometry = new THREE.BufferGeometry();
            const particleCount = 5000;
            const positions = new Float32Array(particleCount * 3);
            const colors = new Float32Array(particleCount * 3);

            for (let i = 0; i < particleCount * 3; i += 3) {
                positions[i] = (Math.random() - 0.5) * 30;
                positions[i + 1] = (Math.random() - 0.5) * 30;
                positions[i + 2] = (Math.random() - 0.5) * 30;

                const colorChoice = Math.random();
                if (colorChoice > 0.66) {
                    // Purple
                    colors[i] = 0.66;
                    colors[i + 1] = 0.33;
                    colors[i + 2] = 0.97;
                } else if (colorChoice > 0.33) {
                    // Cyan
                    colors[i] = 0.13;
                    colors[i + 1] = 0.83;
                    colors[i + 2] = 0.91;
                } else {
                    // Gold
                    colors[i] = 0.98;
                    colors[i + 1] = 0.75;
                    colors[i + 2] = 0.14;
                }
            }

            geometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));
            geometry.setAttribute('color', new THREE.BufferAttribute(colors, 3));

            const material = new THREE.PointsMaterial({
                size: 0.07,
                vertexColors: true,
                transparent: true,
                opacity: 0.8,
                blending: THREE.AdditiveBlending
            });

            particles = new THREE.Points(geometry, material);
            scene.add(particles);

            animate();
        }

        function animate() {
            requestAnimationFrame(animate);

            if (particles) {
                particles.rotation.x += 0.0002;
                particles.rotation.y += 0.0004;

                particles.rotation.x += mouseY * 0.00002;
                particles.rotation.y += mouseX * 0.00004;
            }

            if (renderer && scene && camera) {
                renderer.render(scene, camera);
            }
        }

        document.addEventListener('mousemove', (e) => {
            mouseX = e.clientX - window.innerWidth / 2;
            mouseY = e.clientY - window.innerHeight / 2;
        });

        window.addEventListener('resize', () => {
            if (camera && renderer) {
                camera.aspect = window.innerWidth / window.innerHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(window.innerWidth, window.innerHeight);
            }
        });

        // Initialize after a slight delay to ensure DOM is ready
        window.addEventListener('load', initThree);
    </script>
</body>

</html>